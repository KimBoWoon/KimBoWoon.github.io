<?xml version="1.0" encoding="utf-8"?>
<search>
  
    <entry>
      <title><![CDATA[[Effective Java] 가능하면 제네릭 자료형으로 만들 것]]></title>
      <url>/effective%20java/2019/11/04/used-generic-type/</url>
      <content type="html"><![CDATA[<h1 id="제네릭-클래스-만들기">제네릭 클래스 만들기</h1>

<p>컬렉션 객체 선언을 제네릭화 하거나 JDK에서 제공하는 제네릭 자료형과 메서드를 사용하는 것은 어렵지않다. 제네릭 자료형을 직접 만드는 것은 좀 까다로운데 그래도 가치는 있다. 다음 Stack 클래스를 보자.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Stack</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Object</span><span class="o">[]</span> <span class="n">elements</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">DEFAULT_INITAL_CAPACITY</span> <span class="o">=</span> <span class="mi">16</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="nf">Stack</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[</span><span class="no">DEFAULT_INITAL_CAPACITY</span><span class="o">];</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">push</span><span class="o">(</span><span class="nc">Object</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ensureCapacity</span><span class="o">();</span>
        <span class="n">elements</span><span class="o">[</span><span class="n">size</span><span class="o">++]</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">pop</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">EmptyStackException</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="nc">Object</span> <span class="n">results</span> <span class="o">=</span> <span class="n">elements</span><span class="o">[--</span><span class="n">size</span><span class="o">];</span>
        <span class="n">elements</span><span class="o">[</span><span class="n">size</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// 만기 참조 제거</span>
        <span class="k">return</span> <span class="n">results</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isEmpty</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 적어도 하나 이상의 원소를 담을 공간을 보장한다.
     * 배열의 길이를 늘려야 할 때마다 대략 두 배씩 늘인다.
     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">ensureCapacity</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">elements</span><span class="o">.</span><span class="na">length</span> <span class="o">==</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">elements</span><span class="o">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">size</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>제네릭으로 변경하기 위한 딱 좋은 예제이다. 호환성을 유지하면서도 제네릭 자료형을 사용하도록 개선할 수 있다. 위의 코드에서는 스택에서 꺼낸 자료를 형변환해서 사용해야 하는데 실패할 가능성이 있다.</p>

<p>클래스를 제네릭화하는 첫 번째 단계는 선언부에 형인자를 추가하는 것이다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 제네릭을 사용해 작성한 최초의 Stack 클래스 - 컴파일되지 않는다!</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Stack</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="no">E</span><span class="o">[]</span> <span class="n">elements</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">DEFAULT_INITAL_CAPACITY</span> <span class="o">=</span> <span class="mi">16</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="nf">Stack</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="k">new</span> <span class="no">E</span><span class="o">[</span><span class="no">DEFAULT_INITAL_CAPACITY</span><span class="o">];</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">push</span><span class="o">(</span><span class="no">E</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ensureCapacity</span><span class="o">();</span>
        <span class="n">elements</span><span class="o">[</span><span class="n">size</span><span class="o">++]</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="no">E</span> <span class="nf">pop</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">EmptyStackException</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="no">E</span> <span class="n">results</span> <span class="o">=</span> <span class="n">elements</span><span class="o">[--</span><span class="n">size</span><span class="o">];</span>
        <span class="n">elements</span><span class="o">[</span><span class="n">size</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// 만기 참조 제거</span>
        <span class="k">return</span> <span class="n">results</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isEmpty</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 적어도 하나 이상의 원소를 담을 공간을 보장한다.
     * 배열의 길이를 늘려야 할 때마다 대략 두 배씩 늘인다.
     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">ensureCapacity</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">elements</span><span class="o">.</span><span class="na">length</span> <span class="o">==</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">elements</span><span class="o">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">size</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>바로 경고나 오류없이 컴파일이 성공하면 좋겠지만 그럴 확률은 적다. 오히려 경고나 오류가 없다면 더욱 유심히 살펴봐야한다. 그나마 다행인것은 위의 코드에서 한군데에서 경고가 발생한다는 것이다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Stack</span><span class="o">.</span><span class="na">java</span><span class="o">:</span> <span class="n">generic</span> <span class="n">array</span> <span class="n">creation</span>
<span class="n">elements</span> <span class="o">=</span> <span class="k">new</span> <span class="no">E</span><span class="o">[</span><span class="no">DEFAULT_INITIAL_CAPACITY</span><span class="o">];</span>
           <span class="err">＾</span>
</code></pre></div></div>

<h1 id="경고-및-오류-수정">경고 및 오류 수정</h1>
<p>첫 번째로 제네릭 배열을 만들 수 없다는 조건을 우회하는 것. Object의 배열을 만들어서 제네릭 배열 자료형으로 형변환하는 방법이다. 문법적으로는 문제가 없지만 일반적으로 형 안전성을 보장하는 방법은 아니다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Stack</span><span class="o">.</span><span class="na">java</span><span class="o">:</span> <span class="nl">warning:</span> <span class="o">[</span><span class="n">unchecked</span><span class="o">]</span> <span class="n">unchecked</span> <span class="n">cast</span>
<span class="nl">found:</span> <span class="nc">Object</span><span class="o">[],</span> <span class="nl">required:</span> <span class="no">E</span><span class="o">[]</span>
<span class="n">elements</span> <span class="o">=</span> <span class="o">(</span><span class="no">E</span><span class="o">[])</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[</span><span class="no">DEFAULT_INITIAL_CAPACITY</span><span class="o">];</span>
             <span class="err">＾</span>
</code></pre></div></div>

<p>컴파일러는 형 안전성을 입증할 수 없을지 모르지만, 프로그래머는 할 수 있다. elements는 private이며 Stack 클래스내에서만 사용이 되고 push 메서드를 사용하여 데이터의 삽입이 이뤄지며 그 타입은 모두 E 이므로 무점검 형변환을 해도 아무런 문제가 되지 않는다.</p>

<p>무점검 형변환이 안전함을 증명했다면 경고를 억제하되 범위는 최소한으로 해야한다. Stack 클래스에 생성자에서 무점검 배열 생성을 하는 코드가 전부이므로 생성자 전체적으로 경고를 억제해도 무방하다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// elements 배열에는 push(E)를 통해 전달된 E 형의 객체만 저장된다.</span>
<span class="c1">// 이 정도면 형 안전성은 보장할 수 있지만, 배열의 실생시간 자료형은 E[]가</span>
<span class="c1">// 아니라 항상 Object[]이다!</span>
<span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nf">Stack</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="k">new</span> <span class="no">E</span><span class="o">[</span><span class="no">DEFAULT_INITAL_CAPACITY</span><span class="o">];</span>
<span class="o">}</span>
</code></pre></div></div>

<p>두 번째 방법은 elements의 자료형을 E[]에서 Object[]로 바꾸는 것이다. 그러면 아까와는 다른 오류 메시지를 보게 된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Stack</span><span class="o">.</span><span class="na">java</span><span class="o">:</span> <span class="n">incompatible</span> <span class="n">types</span>
<span class="nl">found:</span> <span class="nc">Object</span><span class="o">,</span> <span class="nl">required:</span> <span class="no">E</span>
<span class="no">E</span> <span class="n">result</span> <span class="o">=</span> <span class="n">elements</span><span class="o">[--</span><span class="n">size</span><span class="o">];</span>
                   <span class="err">＾</span>
</code></pre></div></div>

<p>배열에서 꺼낸 원소의 자료형을 Object에서 E로 변환하도록 코드를 수정하면, 이 오류는 경고로 바뀐다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Stack</span><span class="o">.</span><span class="na">java</span><span class="o">:</span> <span class="nl">warning:</span> <span class="o">[</span><span class="n">unchecked</span><span class="o">]</span> <span class="n">unchecked</span> <span class="n">cast</span>
<span class="nl">found:</span> <span class="nc">Object</span><span class="o">,</span> <span class="nl">required:</span> <span class="no">E</span>
<span class="no">E</span> <span class="n">result</span> <span class="o">=</span> <span class="o">(</span><span class="no">E</span><span class="o">)</span> <span class="n">elements</span><span class="o">[--</span><span class="n">size</span><span class="o">];</span>
                       <span class="err">＾</span>
</code></pre></div></div>

<p>E는 실체화 불가능 자료형이므로 컴파일러는 이 형변환을 실행 중에 검사할 수 없지만 위의 무점검 형변환이 안전하다는 것, 그래서 경고를 억제해도 좋다는 것은 개발자 스스로 쉽게 입증할 수 있다. 다음과 같이 pop 메서드를 수정한다. 단, pop 메서드 전체에 어노테이션을 붙이지 않는다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 무점검 경고를 적절히 억제한 사례</span>
<span class="kd">public</span> <span class="no">E</span> <span class="nf">pop</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">EmptyStackException</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="c1">// 자료형이 E인 원소만 push하므로, 아래의 형변환은 안전하다.</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
    <span class="no">E</span> <span class="n">results</span> <span class="o">=</span> <span class="o">(</span><span class="no">E</span><span class="o">)</span> <span class="n">elements</span><span class="o">[--</span><span class="n">size</span><span class="o">];</span>
    <span class="n">elements</span><span class="o">[</span><span class="n">size</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// 만기 참조 제거</span>
    <span class="k">return</span> <span class="n">results</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>위 두가지 방법중 어떤 방법을 사용해도 상관없다. 다만 두 번째 방법은 많은 곳을 수정할 가능성이 있으므로 첫 번째 방법이 많이 사용된다.</p>
]]></content>
      <categories>
        
          <category> Effective Java </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Effective Java] 배열 대신 리스트를 써라]]></title>
      <url>/effective%20java/2019/11/02/not-array-used-List/</url>
      <content type="html"><![CDATA[<h1 id="배열과-제네릭의-차이">배열과 제네릭의 차이</h1>
<p>첫번째로는 배열은 공변 자료형이다. Sub가 Super의 하위 자료형 이라면 Sub[]도 Super[]의 하위 자료형이라는 것이다. 반면에 제네릭은 불변 자료형이다. Type1과 Type2가 있을 때 <code class="language-plaintext highlighter-rouge">List&lt;Type1&gt;</code>은 <code class="language-plaintext highlighter-rouge">List&lt;Type2&gt;</code>의 상위 자료형이나 하위 자료형이 될 수 없다. 아래의 코드를 보자</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 실행중에 문제를 일으킴</span>
<span class="nc">Object</span><span class="o">[]</span> <span class="n">objectArray</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Long</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
<span class="n">objectArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="s">"I don't fit in"</span><span class="o">;</span>
</code></pre></div></div>

<p>하지만 아래의 코드는 컴파일 조차 안된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">ol</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;;</span> <span class="c1">// 자료형 불일치</span>
<span class="n">ol</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"I don't fit in"</span><span class="o">);</span>
</code></pre></div></div>

<p>둘 중 어떤 방법을 써도 Long 객체 컨터이너 안에 String을 넣을 수 없다. 그러나 배열을 쓰면 실수를 저지른 사실을 프로그램 실행 중에나 알 수 있다.</p>

<p>두번째로는 배열은 실체화 되는 자료형이라는 것이다. 즉, 배열의 각 원소의 자료형은 실행시간에 결정된다는 것이다. 반면 제네릭은 삭제 과정을 통해 구현된다. 즉, 자료형에 관계된 조건들은 컴파일 시점에만 적용되고, 그 각 원소의 자료형 정보는 프로그램이 실행될 때는 삭제된다는 것이다.</p>

<p>이러한 차이점 때문에 배열과 제네릭은 섞어 쓰기 어렵다. <code class="language-plaintext highlighter-rouge">List&lt;String&gt;[]</code>, <code class="language-plaintext highlighter-rouge">new E[]</code> 와 같은 것을 만들려고 하면 제네릭 배열 생성이라는 오류가 발생한다. 제네릭 배열이 생성되지 않는 이유는 형 안전성이 보장되지 않기 때문이다. 아래의 코드를 보자.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 제네릭 배열 생성이 허용되지 않는 이유 - 아래의 코드는 컴파일되지 않는다!</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;[]</span> <span class="n">stringLists</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;[</span><span class="mi">1</span><span class="o">];</span>   <span class="c1">// (1)</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">intList</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">42</span><span class="o">);</span>          <span class="c1">// (2)</span>
<span class="nc">Object</span><span class="o">[]</span> <span class="n">objects</span> <span class="o">=</span> <span class="n">stringLists</span><span class="o">;</span>                     <span class="c1">// (3)</span>
<span class="n">objects</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="n">intList</span><span class="o">;</span>                               <span class="c1">// (4)</span>
<span class="nc">String</span> <span class="n">s</span> <span class="o">=</span> <span class="n">stringLists</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>                   <span class="c1">// (5)</span>
</code></pre></div></div>

<p>(1)이 문제없이 컴파일이 된다면, 제네릭 배열이 만들어질 것이다. (2)는 하나의 원소를 갖는 배열 <code class="language-plaintext highlighter-rouge">List&lt;Integer&gt;</code>를 초기화한다. (3)은 <code class="language-plaintext highlighter-rouge">List&lt;String&gt;</code> 배열을 Object 배열 변수에 대입한다. 배열은 공변 자료형이므로, 가능하다. (4) 에서는 <code class="language-plaintext highlighter-rouge">List&lt;Integer&gt;</code>를 Object 배열에 있는 유일한 원소에 대입한다. 제네릭이 형 삭제를 통해 구현되므로 여기에도 하자는 없다. 하지만 <code class="language-plaintext highlighter-rouge">List&lt;String&gt;</code>만 들어간다고 만들어둔 배열에 <code class="language-plaintext highlighter-rouge">List&lt;Integer&gt;</code>을 저장한것이다. (5)에서는 저장된 원소를 꺼내는 작업을 하는데 사실을 Integer값을 꺼내서 String으로 변환하려는 것이다. 그래서 ClassCastException이 발생한다. 그래서 컴파일러는 (1)에서 오류를 발생시키는 것이다.</p>

<p><code class="language-plaintext highlighter-rouge">List&lt;E&gt;</code>는 성능이 저하되거나 코드가 길어질 수는 있겠으나, 형 안전성과 호환성은 좋아진다.</p>

<p>예를 들어, 동기화된 리스트가 하나 있고 리스트에 원소의 자료형과 같은 자료형의 값 두 개를 인자로 받는 함수가 하나 있다고 하자. 이 함수는 리스트의 원소가 정수면 모두 더하거나 곱하고, 문자열이면 모든 문자열 연결하여 반환하는 함수이다. 이렇게 리스트를 줄이는 것이다. 이러한 함수를 제네릭 없이 작성한다면 아래와 같은 모습일 것이다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">static</span> <span class="nc">Object</span> <span class="nf">reduce</span><span class="o">(</span><span class="nc">List</span> <span class="n">list</span><span class="o">,</span> <span class="nc">Function</span> <span class="n">f</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">initVal</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">synchronized</span><span class="o">(</span><span class="n">list</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Object</span> <span class="n">result</span> <span class="o">=</span> <span class="n">initVal</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Object</span> <span class="n">o</span> <span class="o">:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="n">o</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">Function</span> <span class="o">{</span>
    <span class="nc">Object</span> <span class="nf">apply</span><span class="o">(</span><span class="nc">Object</span> <span class="n">artg1</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">arg2</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>동기화 영역 안에서는 “불가해 메서드”를 호출하면 안된다. 그러니 락을 건 상태에서 리스트를 복사한 다음, 복사본에 작업하도록 메서드를 수정해야 한다. 1.5 이전의 자바에서는 List의 toArray 메서드를 사용한다. 내부적으로 리스트에 락을 걸기 때문이다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 제네릭 없이 작성한 reduce 함수. 병행성 문제는 없다.</span>
<span class="kd">static</span> <span class="nc">Object</span> <span class="nf">reduce</span><span class="o">(</span><span class="nc">List</span> <span class="n">list</span><span class="o">,</span> <span class="nc">Function</span> <span class="n">f</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">initVal</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Object</span><span class="o">[]</span> <span class="n">snapshot</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">toArray</span><span class="o">();</span> <span class="c1">// 리스트에 내부적으로 락을 건다</span>
    <span class="nc">Object</span> <span class="n">result</span> <span class="o">=</span> <span class="n">initVal</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">Object</span> <span class="n">o</span> <span class="o">:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="n">o</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>이런 작업을 제네릭으로 하게 되면 앞서 말한 문제들을 만나게 된다. Function 인터페이스와 reduce 메서드를 제네릭 버전으로 바꿔보자.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">static</span> <span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="no">E</span> <span class="nf">reduce</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="nc">Function</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="n">f</span><span class="o">,</span> <span class="no">E</span> <span class="n">initVal</span><span class="o">)</span> <span class="o">{</span>
    <span class="no">E</span><span class="o">[]</span> <span class="n">snapshot</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">toArray</span><span class="o">();</span> <span class="c1">// 리스트에 내부적으로 락을 건다</span>
    <span class="no">E</span> <span class="n">result</span> <span class="o">=</span> <span class="n">initVal</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="no">E</span> <span class="n">e</span> <span class="o">:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">Function</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="no">T</span> <span class="nf">apply</span><span class="o">(</span><span class="no">T</span> <span class="n">arg1</span><span class="o">,</span> <span class="no">T</span> <span class="n">arg2</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>이렇게 만들고 컴파일하면 오류를가 발생한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Practice</span><span class="o">.</span><span class="na">java</span><span class="o">:</span> <span class="n">incompatible</span> <span class="n">types</span>
<span class="n">found</span> <span class="o">:</span> <span class="nc">Object</span><span class="o">[],</span> <span class="nl">required:</span> <span class="no">E</span><span class="o">[]</span>
<span class="no">E</span><span class="o">[]</span> <span class="n">snapshot</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">toArray</span><span class="o">();</span> <span class="c1">// 리스트에 락을 건다</span>
                           <span class="err">＾</span>
</code></pre></div></div>

<p>Object 배열을 E 배열로 형변환 하면 OK 아닌가? 라고 생각할 수 있지만 그러면 새로운 경고가 뜬다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Practice</span><span class="o">.</span><span class="na">java</span><span class="o">:</span> <span class="nl">warning:</span> <span class="o">[</span><span class="n">unchecked</span><span class="o">]</span> <span class="n">unchecked</span> <span class="n">cast</span>
<span class="n">found</span> <span class="o">:</span> <span class="nc">Object</span><span class="o">[],</span> <span class="nl">required:</span> <span class="no">E</span><span class="o">[]</span>
<span class="no">E</span><span class="o">[]</span> <span class="n">snapshot</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">toArray</span><span class="o">();</span> <span class="c1">// 리스트에 락을 건다</span>
                           <span class="err">＾</span>
</code></pre></div></div>

<p>컴파일러는 실행 도중에 형변환이 안전하게 이루어질지 검사할 수 없다는 뜻이다. 실행 시에 E가 무슨 자료형이 될지 알 수 없기 때문이다. 원소의 자료형 정보는 프로그램이 실행될 때에는 제네릭에서 삭제된다.</p>

<p>그렇다면 어떻게 만들어야 할까? 단순하다 배열 대신 리스트를 사용하면 된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">static</span> <span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="no">E</span> <span class="nf">reduce</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="nc">Function</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="n">f</span><span class="o">,</span> <span class="no">E</span> <span class="n">initVal</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="n">snapshot</span><span class="o">;</span>
    <span class="kd">synchronized</span><span class="o">(</span><span class="n">list</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">snapshot</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;(</span><span class="n">list</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="no">E</span> <span class="n">result</span> <span class="o">=</span> <span class="n">initVal</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="no">E</span> <span class="n">e</span> <span class="o">:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">Function</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="no">T</span> <span class="nf">apply</span><span class="o">(</span><span class="no">T</span> <span class="n">arg1</span><span class="o">,</span> <span class="no">T</span> <span class="n">arg2</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>앞에 나왔던 코드들 보다 길지만, 실행 도중에 ClassCastException이 발생할 일이 없으므로 그만한 값어치가 있다.</p>
]]></content>
      <categories>
        
          <category> Effective Java </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Effective Java] 무점검 경고를 제거하라]]></title>
      <url>/effective%20java/2019/11/01/delete-unchecked-warning/</url>
      <content type="html"><![CDATA[<h1 id="제네릭의-경고를-무시하지-마라">제네릭의 경고를 무시하지 마라!</h1>
<p>제네릭을 사용하다 보면 무수히 많은 경고를 보게 된다. 무점검 형변환 경고, 무점검 메서드 호출 경고, 무점검 제네릭 배열 생겅 경고, 무점검 변환 경고 등이 있다.
아무리 고수라도 제네릭을 사용하여 만들어낸 코드가 깔끔하게 컴파일이 되기는 어렵다. 그래서 우리는 신경을 쓰면서 제네릭을 만들어야 하고 나중에 경고를 가능하다면 모두 지워주는게 좋다.
몇 가지는 컴파일러가 친절히 알려준다. 아래에 코드를 보자.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Lark</span><span class="o">&gt;</span> <span class="n">exaltation</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSete</span><span class="o">();</span>
</code></pre></div></div>

<p>컴파일러는 에러 메시지를 보여준다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Practice</span><span class="o">.</span><span class="na">java</span> <span class="nl">warning:</span> <span class="o">[</span><span class="n">unchecked</span><span class="o">]</span> <span class="n">unchecked</span> <span class="n">conversion</span>
<span class="n">found</span> <span class="o">:</span> <span class="nc">HashSet</span><span class="o">,</span> <span class="nl">required:</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Lark</span><span class="o">&gt;</span>
<span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Lark</span><span class="o">&gt;</span> <span class="n">exaltation</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">();</span>
                    <span class="err">＾</span>
</code></pre></div></div>

<p>컴파일러가 가르쳐준대로 수정하면 경고는 사라진다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Lark</span><span class="o">&gt;</span> <span class="n">exaltation</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSete</span><span class="o">&lt;</span><span class="nc">Lark</span><span class="o">&gt;();</span>
</code></pre></div></div>

<p>이렇게 가능하다면 모든 경고 메시지는 제거해주는 것이 좋다. 코드의 형 안전성이 보장되기 때문이다.</p>

<h1 id="supresswarningsunchecked">@SupressWarnings(“unchecked”)</h1>
<p>이 어노테이션의 사용은 최대한 자제해야한다. 형 안전성 증명도 없이 경고를 억제하면, 프로그램 안전성에 대해 그릇된 생각을 갖게 될 뿐이다. 컴파일은 되겠지만 프로그램 실행 도중에 ClassCastException을 만나게 된다면 어디서 어떻게 수정해야하는지 감이 안잡히게 될것이다.</p>

<p>만약 @SupressWarnings(“unchecked”) 어노테이션을 사용하게 된다면 가능한 한 작은 범위에 적용해야한다. 보통은 변수 선언이나, 아주 짧은 메서드 또는 생성자에 붙인다. 절대로 클래스 전체에 @SupressWarnings(“unchecked”)를 적용하지 말아라. 중요한 경고 메시지를 놓치는 원인이다.</p>

<p>길이가 한 줄 이상인 메서드나 생성자에 사용된 @SupressWarnings(“unchecked”) 어노테이션을 지역 변수 선언문 앞으로 이동시킬 수 있을 때가 있다. 그러려면 새로운 지역 변수 선언문을 작성해야 할 수도 있으나, 그럴만한 가치는 있다. 다음은 ArrayList 클래스에 toArray 메서드이다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="no">T</span><span class="o">[]</span> <span class="nf">toArray</span><span class="o">(</span><span class="no">T</span><span class="o">[]</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">a</span><span class="o">.</span><span class="na">length</span> <span class="o">&lt;</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="no">T</span><span class="o">[])</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">elements</span><span class="o">,</span> <span class="n">size</span><span class="o">,</span> <span class="n">a</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">arraycopy</span><span class="o">(</span><span class="n">elements</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">a</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">size</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">a</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">a</span><span class="o">[</span><span class="n">size</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ArrayList 클래스를 컴파일해 보면 아래와 같은 경고 메시지가 출력된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Practice</span><span class="o">.</span><span class="na">java</span> <span class="nl">warning:</span> <span class="o">[</span><span class="n">unchecked</span><span class="o">]</span> <span class="n">unchecked</span> <span class="n">cast</span>
<span class="n">found</span> <span class="o">:</span> <span class="nc">Object</span><span class="o">[],</span> <span class="nl">required:</span> <span class="no">T</span><span class="o">[]</span>
<span class="nf">return</span> <span class="o">(</span><span class="no">T</span><span class="o">[])</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">elements</span><span class="o">,</span> <span class="n">size</span><span class="o">,</span> <span class="n">a</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>
                          <span class="err">＾</span>
</code></pre></div></div>

<p>@SupressWarnings(“unchecked”) 어노테이션은 return문에 붙일 수 없다. 선언문이 아니기 때문이다. 메서드 전체에 붙이고 싶겠지만 절대로 그러면 안된다. 대신, 반환값을 담을 지역 변수를 선언한 다음에 해당 선언문 앞에 어노테이션을 붙여라.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="no">T</span><span class="o">[]</span> <span class="nf">toArray</span><span class="o">(</span><span class="no">T</span><span class="o">[]</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">a</span><span class="o">.</span><span class="na">length</span> <span class="o">&lt;</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 아래의 형변환은 배열의 자료형이 인자로 전달된 자료형인 T[]와</span>
        <span class="c1">// 같으므로 정확하다.</span>
        <span class="nd">@SupressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span> <span class="no">T</span><span class="o">[]</span> <span class="n">result</span> <span class="o">=</span> 
            <span class="o">(</span><span class="no">T</span><span class="o">[])</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">elements</span><span class="o">,</span> <span class="n">size</span><span class="o">,</span> <span class="n">a</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>

        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">arraycopy</span><span class="o">(</span><span class="n">elements</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">a</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">size</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">a</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">a</span><span class="o">[</span><span class="n">size</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>이 메서드는 깔끔하게 컴파일 될 뿐 아니라 무점검 코드에 대한 경고 메시지의 억제 범위를 최소한으로 줄이고 있다.</p>

<p>그리고 @SupressWarnings(“unchecked”) 어노테이션을 사용할 때마다 왜 형 안전성을 위반하지 않는지 밝히는 주석을 반드시 붙여라. 다른 사람이 이해하기 좋고 형 안전성을 깨뜨릴 가능성이 줄어들게 된다.</p>
]]></content>
      <categories>
        
          <category> Effective Java </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Effective Java] 새 코드에는 무인자 제네릭 자료형을 사용하지 마라]]></title>
      <url>/effective%20java/2019/10/30/not-used-generic-parm/</url>
      <content type="html"><![CDATA[<h1 id="과거-java의-컬렉션">과거 Java의 컬렉션</h1>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 무인자 컬렉션 자료형. 이렇게 만들면 안된다.</span>
<span class="cm">/**
* 내 우표 컬렉션. Stamp 객체만 보관한다.
*/</span>
<span class="kd">private</span> <span class="kd">final</span> <span class="nc">Collection</span> <span class="n">stamps</span> <span class="o">=</span> <span class="o">...;</span>
</code></pre></div></div>

<p>엉뚱한 자료형을 넣어도 아무런 오류없이 컴파일이 된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 우표 객체만 담을 수 있는 컬렉션에 동전을 넣었다.</span>
<span class="n">stamps</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Coin</span><span class="o">(...));</span>
</code></pre></div></div>

<p>사용하려고 하면 당연히 오류가 발생된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="o">(</span><span class="nc">Iterator</span> <span class="n">i</span> <span class="o">=</span> <span class="n">stamps</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span> <span class="n">i</span><span class="o">.</span><span class="na">hasNext</span><span class="o">();</span> <span class="o">)</span> <span class="o">{</span>
    <span class="nc">Stamp</span> <span class="n">s</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Stamp</span><span class="o">)</span> <span class="n">i</span><span class="o">.</span><span class="na">next</span><span class="o">();</span> <span class="c1">// ClassCastException 예외 발생</span>
    <span class="o">...</span> <span class="c1">// 우표 객체로 뭔가 작업을 한다.</span>
<span class="o">}</span>
</code></pre></div></div>

<p>오류는 가능한 빨리 발견해야 하며, 컴파일할 때 발견할 수 있으면 가장 이상적이다. 하지만 위의 코드는 컴파일이 되고 한참 뒤에나 오류를 발견할 수 있다. 그리고 문제가 뭔지 한참을 해매게 될것이다.
컬렉션을 사용하면 위와 같은 에러를 컴파일 타임에 발견할 수 있다.</p>

<h1 id="제네릭의-사용">제네릭의 사용</h1>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 형인자 컬렉션 자료형 - 형 안전성 확보</span>
<span class="kd">private</span> <span class="kd">final</span> <span class="nc">Collection</span><span class="o">&lt;</span><span class="nc">Stamp</span><span class="o">&gt;</span> <span class="n">stamps</span> <span class="o">=</span> <span class="o">...;</span>
</code></pre></div></div>

<p>이 선언을 보고 컴파일러는 stamps 컬렉션에 Stamp만 들어가야 한다는 것을 이해하며, 실제로 Stamp 객체만 삽입 된다. 또한 형변환을 하지 않아도 컴파일러가 형변환을 진행하며 이 형변환은 절대 실패할 일이없다. (제네릭을 이해하는 컴파일러로 모든 코드를 컴파일하고, 컴파일 할 때 발생하거나 경고가 없어야 한다.)</p>

<h1 id="제네릭과-무인자-자료형">제네릭과 무인자 자료형</h1>
<p>과거의 Java는 무인자 자료형을 사용해서 형 안전성이 없었고, 제네릭의 장점 중 하나인 표현력 측면에서 손해를 보았다. 무인자 자료형은 사용하면 안되지만 <code class="language-plaintext highlighter-rouge">List&lt;Object&gt;</code>와 같은 자료형은 써도 괜찮다. 무인자 자료형과의 차이는 형 검사 절차를 완전히 생략 하냐 안하냐 인것이다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 실행 도중에 오류를 일으키는 무인자 자료형 사용 예</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">strings</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;();</span>
    <span class="n">unsafeAdd</span><span class="o">(</span><span class="n">strings</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Integer</span><span class="o">(</span><span class="mi">42</span><span class="o">));</span>
    <span class="nc">String</span> <span class="n">s</span> <span class="o">=</span> <span class="n">strings</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span> <span class="c1">// 컴파일러가 자동으로 형변환</span>
<span class="o">}</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">unsafeAdd</span><span class="o">(</span><span class="nc">List</span> <span class="n">list</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>이 프로그램은 컴파일은 성공하겠지만 무인자 자료형의 사용으로 경고가 뜬다. 그리고 실제로 실행하면 <code class="language-plaintext highlighter-rouge">strings.get(0)</code>의 실행 결과를 String으로 변환하려 하기 때문에 ClassCastException 예외가 발생한다. 위의 unsafeAdd의 List를 <code class="language-plaintext highlighter-rouge">List&lt;Object&gt;</code>로 수정하면 오류가 발생하면서 컴파일이 실패할 것이다.</p>

<p>컬렉션에 들어갈 원소들이 자료형을 모르고 상관할 필요도 없다면 무인자 자료형을 써보고 싶을 것이다. 제네릭에 익숙하지 않다면 아래와 같은 코드를 만들것이다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">static</span> <span class="kt">int</span> <span class="nf">numElementsInCommon</span><span class="o">(</span><span class="nc">Set</span> <span class="n">s1</span><span class="o">,</span> <span class="nc">Set</span> <span class="n">s2</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">Object</span> <span class="n">o1</span> <span class="o">:</span> <span class="n">s1</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">s2</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">o1</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">result</span><span class="o">++;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>위의 코드는 정상 작동하지만 무인자 자료형을 사용하므로 위험하다.
Java는 비안정적 와일드카드 자료형이라는 좀 더 안전한 대안을 제공한다. 제네릭 자료형을 쓰고 싶으나 실제 형 인자가 무엇인지는 모르거나 신경 쓰고 싶지 않을 때는 형 인자로 ‘?’를 쓰면 된다. 이 자료형은 어떤 Set이건 참조가 가능하다. 위의 코드에 비한정적 와일드카드 자료형을 사용하면 다음과 같은 코드가 된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">static</span> <span class="kt">int</span> <span class="nf">numElementsInCommon</span><span class="o">(</span><span class="nc">Set</span><span class="o">&lt;?&gt;</span> <span class="n">s1</span><span class="o">,</span> <span class="nc">Set</span><span class="o">&lt;?&gt;</span> <span class="n">s2</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">Object</span> <span class="n">o1</span> <span class="o">:</span> <span class="n">s1</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">s2</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">o1</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">result</span><span class="o">++;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>?만 넣는다고 정말 안전 하냐고 생각할 수 있지만 정말로 안전하다. 무인자 자료형은 아무 객체나 넣을 수 있어서, 컬렉션의 자료형 불변식이 쉽게 깨진다.</p>

<h1 id="예외">예외</h1>
<ol>
  <li>클래스 리터럴에는 반드시 무인자 자료형을 사용해야 한다.
    <ul>
      <li>Java 표준에 따르면, 클래스 리터럴에는 형인자 자료형을 쓸 수 없다. <code class="language-plaintext highlighter-rouge">List.class</code>, <code class="language-plaintext highlighter-rouge">String[].class</code>, <code class="language-plaintext highlighter-rouge">int.class</code>는 가능하나 <code class="language-plaintext highlighter-rouge">List&lt;String&gt;.class</code>, <code class="language-plaintext highlighter-rouge">List&lt;?&gt;.class</code>는 불가능하다는 말이다.</li>
    </ul>
  </li>
  <li>instanceof 연산자 사용 규칙
    <ul>
      <li>제네릭 자료형 정보는 프로그램이 실행될 때는 지워지기 때문에, instanceof 연산자는 비한정적 와일드카드 자료형 이외의 형인자 자료형에 적용할 수 없다.</li>
      <li>제네릭 자료형에 instanceof 연산자를 적용할 때는 다음과 같이 하는 것이 좋다.
        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1">// instanceof 연산자에는 무인자 자료형을 써도 OK</span>
 <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="nc">Set</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// 무인자 자료형</span>
  <span class="nc">Set</span><span class="o">&lt;?&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Set</span><span class="o">&lt;?&gt;)</span> <span class="n">o</span><span class="o">;</span> <span class="c1">// 와일드카드 자료형</span>
 <span class="o">}</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ol>
]]></content>
      <categories>
        
          <category> Effective Java </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Android] Retrofit을 위한 xml converter]]></title>
      <url>/android/2019/07/22/android-xml-converter/</url>
      <content type="html"><![CDATA[<h1 id="수정2019-10-28">수정(2019-10-28)</h1>
<ul>
  <li><a href="https://github.com/Tickaroo/tikxml/blob/master/docs/AnnotatingModelClasses.md">TikXml Doc</a>를 꼼꼼히 읽어보자. 꼼꼼하게 읽지 않아서 아래와 같이 멍청하게 코딩했다.</li>
</ul>

<h1 id="xml-parsing">xml parsing</h1>
<p><img src="https://raw.githubusercontent.com/KimBoWoon/KimBoWoon.github.io/master/_img/android/retrofit-converter.PNG" alt="그림" /></p>

<p>위 사진과 같이 retrofit에는 다양한 컨버터가 존재합니다. 다만 simple xml converter는 deprecated가 되었습니다.</p>

<p><img src="https://raw.githubusercontent.com/KimBoWoon/KimBoWoon.github.io/master/_img/android/simple-xml-converter-deprecated.PNG" alt="그림" /></p>

<p>JAXB converter라는 다른 방법을 소개하기는 하지만 안드로이드에서는 작동을 안한다고 합니다.</p>

<p>그래서 더 많은 정보를 찾아보았고 JakeWharton이 말하는 tikxml을 사용했습니다.</p>

<h1 id="tikxml">TikXml</h1>
<p>사용법은 간단(?)합니다. 기존에 사용하던 것처럼 retrofit에 컨버터를 추가하면 됩니다. 다만 필요하다면 사전에 TikXml 인스턴스를 만들어서 넘겨줘야합니다.
저는 rss를 파싱해서 제가 사용한 방법을 토대로 보여드리겠습니다.</p>

<div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">implementation</span> <span class="s1">'com.tickaroo.tikxml:retrofit-converter:0.8.13'</span>
</code></pre></div></div>

<p>일단 gradle에 라이브러리를 추가합니다.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">tikXml</span><span class="p">:</span> <span class="nc">TikXml</span> <span class="p">=</span> <span class="nc">TikXml</span><span class="p">.</span><span class="nc">Builder</span><span class="p">()</span>
    <span class="p">.</span><span class="nf">addTypeConverter</span><span class="p">(</span><span class="nc">Date</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">,</span> <span class="nc">MyDateConverter</span><span class="p">())</span>
    <span class="p">.</span><span class="nf">addTypeAdapter</span><span class="p">(</span><span class="nc">Rss</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">,</span> <span class="nc">RssTypeAdapter</span><span class="p">())</span>
    <span class="p">.</span><span class="nf">addTypeAdapter</span><span class="p">(</span><span class="nc">Channel</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">,</span> <span class="nc">ChannelTypeAdapter</span><span class="p">())</span>
    <span class="p">.</span><span class="nf">addTypeAdapter</span><span class="p">(</span><span class="nc">Image</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">,</span> <span class="nc">ImageTypeAdapter</span><span class="p">())</span>
    <span class="p">.</span><span class="nf">addTypeAdapter</span><span class="p">(</span><span class="nc">Item</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">,</span> <span class="nc">ItemTypeAdapter</span><span class="p">())</span>
    <span class="p">.</span><span class="nf">build</span><span class="p">()</span>

<span class="kd">val</span> <span class="py">client</span><span class="p">:</span> <span class="nc">Retrofit</span> <span class="p">=</span> <span class="nc">Retrofit</span><span class="p">.</span><span class="nc">Builder</span><span class="p">()</span>
    <span class="p">.</span><span class="nf">baseUrl</span><span class="p">(</span><span class="nc">BASE_URL</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">addConverterFactory</span><span class="p">(</span><span class="nc">TikXmlConverterFactory</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">tikXml</span><span class="p">))</span>
    <span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="nf">createOkHttpClient</span><span class="p">())</span>
    <span class="p">.</span><span class="nf">build</span><span class="p">()</span>
</code></pre></div></div>

<p>우선 TikXml 인스턴트를 만드는데 두 가지 옵션을 더 추가합니다. addTypeConverter는 파싱하기위해 변환이 필요한것들을 위한 컨버터를 추가하는 것이고 addTypeAdapter은 해당하는 xml에 대해 어떤 엘리먼트들을 파싱할건지 추가하는겁니다.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Xml</span>
<span class="kd">data class</span> <span class="nc">Rss</span><span class="p">(</span>
    <span class="nd">@Attribute</span>
    <span class="kd">var</span> <span class="py">version</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="nd">@Element</span>
    <span class="kd">var</span> <span class="py">channel</span><span class="p">:</span> <span class="nc">Channel</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="k">constructor</span><span class="p">()</span> <span class="p">:</span> <span class="k">this</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="nc">Channel</span><span class="p">())</span>
<span class="p">}</span>

<span class="nd">@Xml</span>
<span class="kd">data class</span> <span class="nc">Channel</span><span class="p">(</span>
    <span class="nd">@PropertyElement</span>
    <span class="kd">var</span> <span class="py">title</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="nd">@PropertyElement</span>
    <span class="kd">var</span> <span class="py">link</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="nd">@PropertyElement</span>
    <span class="kd">var</span> <span class="py">language</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="nd">@PropertyElement</span>
    <span class="kd">var</span> <span class="py">copyright</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="nd">@PropertyElement</span>
    <span class="kd">var</span> <span class="py">pubDate</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="nd">@PropertyElement</span>
    <span class="kd">var</span> <span class="py">lastBuildDate</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="nd">@PropertyElement</span>
    <span class="kd">var</span> <span class="py">description</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="nd">@Element</span>
    <span class="kd">var</span> <span class="py">image</span><span class="p">:</span> <span class="nc">Image</span><span class="p">,</span>
    <span class="nd">@PropertyElement</span>
    <span class="kd">var</span> <span class="py">item</span><span class="p">:</span> <span class="nc">ArrayList</span><span class="p">&lt;</span><span class="nc">Item</span><span class="p">&gt;</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="k">constructor</span><span class="p">()</span> <span class="p">:</span> <span class="k">this</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="nc">Image</span><span class="p">(),</span> <span class="nc">ArrayList</span><span class="p">&lt;</span><span class="nc">Item</span><span class="p">&gt;())</span>
<span class="p">}</span>

<span class="nd">@Xml</span>
<span class="kd">data class</span> <span class="nc">Image</span><span class="p">(</span>
    <span class="nd">@PropertyElement</span>
    <span class="kd">var</span> <span class="py">title</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="nd">@PropertyElement</span>
    <span class="kd">var</span> <span class="py">url</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="nd">@PropertyElement</span>
    <span class="kd">var</span> <span class="py">link</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="k">constructor</span><span class="p">()</span> <span class="p">:</span> <span class="k">this</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">data class</span> <span class="nc">Item</span><span class="p">(</span>
    <span class="nd">@PropertyElement</span>
    <span class="kd">var</span> <span class="py">title</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="nd">@PropertyElement</span>
    <span class="kd">var</span> <span class="py">link</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="nd">@PropertyElement</span>
    <span class="kd">var</span> <span class="py">description</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="nd">@PropertyElement</span>
    <span class="kd">var</span> <span class="py">author</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="nd">@PropertyElement</span>
    <span class="kd">var</span> <span class="py">pubDate</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">var</span> <span class="py">ogTag</span><span class="p">:</span> <span class="nc">OGTag</span> <span class="p">=</span> <span class="nc">OGTag</span><span class="p">()</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="k">constructor</span><span class="p">()</span> <span class="p">:</span> <span class="k">this</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="nc">OGTag</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></div></div>

<p>@Attribute는 엘리먼트들이 가진 속성을 추출하는것이고 @PropertyElement는 엘리먼트를 추출하는 어노테이션입니다.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">RssTypeAdapter</span> <span class="p">:</span> <span class="nc">TypeAdapter</span><span class="p">&lt;</span><span class="nc">Rss</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">fromXml</span><span class="p">(</span><span class="n">reader</span><span class="p">:</span> <span class="nc">XmlReader</span><span class="p">?,</span> <span class="n">config</span><span class="p">:</span> <span class="nc">TikXmlConfig</span><span class="p">?):</span> <span class="nc">Rss</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">rss</span> <span class="p">=</span> <span class="nc">Rss</span><span class="p">()</span>
        <span class="n">reader</span><span class="o">!!</span><span class="p">.</span><span class="nf">nextAttributeName</span><span class="p">()</span>
        <span class="n">rss</span><span class="p">.</span><span class="n">version</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">nextAttributeValue</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="nf">hasElement</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">reader</span><span class="p">.</span><span class="nf">beginElement</span><span class="p">()</span>
            <span class="n">reader</span><span class="p">.</span><span class="nf">nextElementName</span><span class="p">()</span>
            <span class="kd">val</span> <span class="py">type</span> <span class="p">=</span> <span class="n">config</span><span class="o">!!</span><span class="p">.</span><span class="nf">getTypeAdapter</span><span class="p">(</span><span class="nc">Channel</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span>
            <span class="n">rss</span><span class="p">.</span><span class="n">channel</span> <span class="p">=</span> <span class="n">type</span><span class="p">.</span><span class="nf">fromXml</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
            <span class="n">reader</span><span class="p">.</span><span class="nf">endElement</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">rss</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toXml</span><span class="p">(</span><span class="n">writer</span><span class="p">:</span> <span class="nc">XmlWriter</span><span class="p">?,</span> <span class="n">config</span><span class="p">:</span> <span class="nc">TikXmlConfig</span><span class="p">?,</span> <span class="n">value</span><span class="p">:</span> <span class="nc">Rss</span><span class="p">?,</span> <span class="n">overridingXmlElementTagName</span><span class="p">:</span> <span class="nc">String</span><span class="p">?)</span> <span class="p">{</span>

    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ChannelTypeAdapter</span> <span class="p">:</span> <span class="nc">TypeAdapter</span><span class="p">&lt;</span><span class="nc">Channel</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">fromXml</span><span class="p">(</span><span class="n">reader</span><span class="p">:</span> <span class="nc">XmlReader</span><span class="p">?,</span> <span class="n">config</span><span class="p">:</span> <span class="nc">TikXmlConfig</span><span class="p">?):</span> <span class="nc">Channel</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">channel</span><span class="p">:</span> <span class="nc">Channel</span> <span class="p">=</span> <span class="nc">Channel</span><span class="p">()</span>
        <span class="kd">var</span> <span class="py">type</span><span class="p">:</span> <span class="nc">TypeAdapter</span><span class="p">&lt;</span><span class="err">*</span><span class="p">&gt;</span>

        <span class="k">while</span> <span class="p">(</span><span class="n">reader</span><span class="o">!!</span><span class="p">.</span><span class="nf">hasElement</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">reader</span><span class="p">.</span><span class="nf">beginElement</span><span class="p">()</span>

            <span class="k">when</span> <span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="nf">nextElementName</span><span class="p">())</span> <span class="p">{</span>
                <span class="s">"title"</span> <span class="p">-&gt;</span> <span class="n">channel</span><span class="p">.</span><span class="n">title</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">nextTextContent</span><span class="p">()</span>
                <span class="s">"link"</span> <span class="p">-&gt;</span> <span class="n">channel</span><span class="p">.</span><span class="n">link</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">nextTextContent</span><span class="p">()</span>
                <span class="s">"language"</span> <span class="p">-&gt;</span> <span class="n">channel</span><span class="p">.</span><span class="n">language</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">nextTextContent</span><span class="p">()</span>
                <span class="s">"copyright"</span> <span class="p">-&gt;</span> <span class="n">channel</span><span class="p">.</span><span class="n">copyright</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">nextTextContent</span><span class="p">()</span>
                <span class="s">"pubDate"</span> <span class="p">-&gt;</span> <span class="n">channel</span><span class="p">.</span><span class="n">pubDate</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">nextTextContent</span><span class="p">()</span>
                <span class="s">"lastBuildDate"</span> <span class="p">-&gt;</span> <span class="n">channel</span><span class="p">.</span><span class="n">lastBuildDate</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">nextTextContent</span><span class="p">()</span>
                <span class="s">"description"</span> <span class="p">-&gt;</span> <span class="n">channel</span><span class="p">.</span><span class="n">description</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">nextTextContent</span><span class="p">()</span>
                <span class="s">"image"</span> <span class="p">-&gt;</span> <span class="p">{</span>
                    <span class="n">type</span> <span class="p">=</span> <span class="n">config</span><span class="o">!!</span><span class="p">.</span><span class="nf">getTypeAdapter</span><span class="p">(</span><span class="nc">Image</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span>
                    <span class="n">channel</span><span class="p">.</span><span class="n">image</span> <span class="p">=</span> <span class="n">type</span><span class="p">.</span><span class="nf">fromXml</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="s">"item"</span> <span class="p">-&gt;</span> <span class="p">{</span>
                    <span class="n">type</span> <span class="p">=</span> <span class="n">config</span><span class="o">!!</span><span class="p">.</span><span class="nf">getTypeAdapter</span><span class="p">(</span><span class="nc">Item</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span>
                    <span class="n">channel</span><span class="p">.</span><span class="n">item</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">type</span><span class="p">.</span><span class="nf">fromXml</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="n">config</span><span class="p">))</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="p">-&gt;</span> <span class="p">{</span>
                    <span class="nc">Log</span><span class="p">.</span><span class="nf">i</span><span class="p">(</span><span class="s">"Channel"</span><span class="p">,</span> <span class="s">"not found xml element"</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">reader</span><span class="p">.</span><span class="nf">endElement</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">channel</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toXml</span><span class="p">(</span>
        <span class="n">writer</span><span class="p">:</span> <span class="nc">XmlWriter</span><span class="p">?,</span>
        <span class="n">config</span><span class="p">:</span> <span class="nc">TikXmlConfig</span><span class="p">?,</span>
        <span class="n">value</span><span class="p">:</span> <span class="nc">Channel</span><span class="p">?,</span>
        <span class="n">overridingXmlElementTagName</span><span class="p">:</span> <span class="nc">String</span><span class="p">?</span>
    <span class="p">)</span> <span class="p">{</span>

    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ImageTypeAdapter</span> <span class="p">:</span> <span class="nc">TypeAdapter</span><span class="p">&lt;</span><span class="nc">Image</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">fromXml</span><span class="p">(</span><span class="n">reader</span><span class="p">:</span> <span class="nc">XmlReader</span><span class="p">?,</span> <span class="n">config</span><span class="p">:</span> <span class="nc">TikXmlConfig</span><span class="p">?):</span> <span class="nc">Image</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">image</span><span class="p">:</span> <span class="nc">Image</span> <span class="p">=</span> <span class="nc">Image</span><span class="p">()</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">reader</span><span class="o">!!</span><span class="p">.</span><span class="nf">hasElement</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">reader</span><span class="p">.</span><span class="nf">beginElement</span><span class="p">()</span>
            <span class="k">when</span> <span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="nf">nextElementName</span><span class="p">())</span> <span class="p">{</span>
                <span class="s">"title"</span> <span class="p">-&gt;</span> <span class="n">image</span><span class="p">.</span><span class="n">title</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">nextTextContent</span><span class="p">()</span>
                <span class="s">"url"</span> <span class="p">-&gt;</span> <span class="n">image</span><span class="p">.</span><span class="n">url</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">nextTextContent</span><span class="p">()</span>
                <span class="s">"link"</span> <span class="p">-&gt;</span> <span class="n">image</span><span class="p">.</span><span class="n">link</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">nextTextContent</span><span class="p">()</span>
                <span class="k">else</span> <span class="p">-&gt;</span> <span class="p">{</span>
                    <span class="nc">Log</span><span class="p">.</span><span class="nf">i</span><span class="p">(</span><span class="s">"Image"</span><span class="p">,</span> <span class="s">"not found xml element"</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">reader</span><span class="p">.</span><span class="nf">endElement</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">image</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toXml</span><span class="p">(</span><span class="n">writer</span><span class="p">:</span> <span class="nc">XmlWriter</span><span class="p">?,</span> <span class="n">config</span><span class="p">:</span> <span class="nc">TikXmlConfig</span><span class="p">?,</span> <span class="n">value</span><span class="p">:</span> <span class="nc">Image</span><span class="p">?,</span> <span class="n">overridingXmlElementTagName</span><span class="p">:</span> <span class="nc">String</span><span class="p">?)</span> <span class="p">{</span>

    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ItemTypeAdapter</span> <span class="p">:</span> <span class="nc">TypeAdapter</span><span class="p">&lt;</span><span class="nc">Item</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">fromXml</span><span class="p">(</span><span class="n">reader</span><span class="p">:</span> <span class="nc">XmlReader</span><span class="p">?,</span> <span class="n">config</span><span class="p">:</span> <span class="nc">TikXmlConfig</span><span class="p">?):</span> <span class="nc">Item</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">item</span> <span class="p">=</span> <span class="nc">Item</span><span class="p">()</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">reader</span><span class="o">!!</span><span class="p">.</span><span class="nf">hasElement</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">reader</span><span class="p">.</span><span class="nf">beginElement</span><span class="p">()</span>
            <span class="k">when</span> <span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="nf">nextElementName</span><span class="p">())</span> <span class="p">{</span>
                <span class="s">"title"</span> <span class="p">-&gt;</span> <span class="n">item</span><span class="p">.</span><span class="n">title</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">nextTextContent</span><span class="p">()</span>
                <span class="s">"link"</span> <span class="p">-&gt;</span> <span class="n">item</span><span class="p">.</span><span class="n">link</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">nextTextContent</span><span class="p">()</span>
                <span class="s">"description"</span> <span class="p">-&gt;</span> <span class="n">item</span><span class="p">.</span><span class="n">description</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">nextTextContent</span><span class="p">()</span>
                <span class="s">"author"</span> <span class="p">-&gt;</span> <span class="n">item</span><span class="p">.</span><span class="n">author</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">nextTextContent</span><span class="p">()</span>
                <span class="s">"pubDate"</span> <span class="p">-&gt;</span> <span class="n">item</span><span class="p">.</span><span class="n">pubDate</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">nextTextContent</span><span class="p">()</span>
                <span class="k">else</span> <span class="p">-&gt;</span> <span class="p">{</span>
                    <span class="nc">Log</span><span class="p">.</span><span class="nf">i</span><span class="p">(</span><span class="s">"Image"</span><span class="p">,</span> <span class="s">"not found xml element"</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">reader</span><span class="p">.</span><span class="nf">endElement</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">item</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toXml</span><span class="p">(</span>
        <span class="n">writer</span><span class="p">:</span> <span class="nc">XmlWriter</span><span class="p">?,</span>
        <span class="n">config</span><span class="p">:</span> <span class="nc">TikXmlConfig</span><span class="p">?,</span>
        <span class="n">value</span><span class="p">:</span> <span class="nc">Item</span><span class="p">?,</span>
        <span class="n">overridingXmlElementTagName</span><span class="p">:</span> <span class="nc">String</span><span class="p">?</span>
    <span class="p">)</span> <span class="p">{</span>

    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">MyDateConverter</span> <span class="p">:</span> <span class="nc">TypeConverter</span><span class="p">&lt;</span><span class="nc">Date</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">formatter</span> <span class="p">=</span> <span class="nc">SimpleDateFormat</span><span class="p">(</span><span class="s">"yyyy.MM.dd"</span><span class="p">)</span>

    <span class="nd">@Throws</span><span class="p">(</span><span class="nc">Exception</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">read</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Date</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">formatter</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nd">@Throws</span><span class="p">(</span><span class="nc">Exception</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">write</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nc">Date</span><span class="p">):</span> <span class="nc">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">formatter</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>어댑터에서도 알수있듯이 fromXml에서 원하는 엘리먼트들을 파싱합니다. toXml에서는 xml을 만드는것 같은데 아직 사용해보지 않아서 모르겠습니다.</p>

<h1 id="주의점">주의점</h1>
<p>TikXml은 현재 0.8.15버전이 최신버전인데 이 버전에서 오류가 있어서 0.8.15를 사용할 수 없습니다. 그래서 0.8.13버전을 사용해야합니다. 오류 내용은 com.tickaroo.tikxml:retrofit-converter:0.8.15 이곳에 어노테이션 라이브러리가 첨부되지 않았다고 합니다. 해당 라이브러리에 이슈를 참조하면 자기들도 왜 포함이  잘 모른다고 서술하고 있습니다.</p>

<h1 id="참조">참조</h1>
<ul>
  <li>TikXml : https://github.com/Tickaroo/tikxml</li>
  <li>TikXml 오류 이슈 : https://github.com/Tickaroo/tikxml/issues/115</li>
  <li>simple xml converter deprecated : https://github.com/square/retrofit/issues/2733</li>
  <li>TikXml Docment : https://github.com/Tickaroo/tikxml/blob/master/docs/AnnotatingModelClasses.md</li>
</ul>
]]></content>
      <categories>
        
          <category> Android </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Effective Java] 멤버 클래스는 가능하면 static으로 선언하라]]></title>
      <url>/effective%20java/2019/06/06/member-class-static/</url>
      <content type="html"><![CDATA[<h1 id="중첩-클래스">중첩 클래스</h1>
<p>중첨 클래스란 클래스안에 있는 또 다른 클래스를 말한다. 중첩 클래스는 네가지 종류가 있다.
정적 멤버 클래스, 비정적 멤버 클래스, 익명 클래스, 지역 클래스가 있다.</p>

<h2 id="정적-클래스">정적 클래스</h2>
<p>이 클래스는 평범한 클래스에 또 다른 static 클래스가 들어있는 것이다. 이 클래스는 바깥 클래스의 모든 멤버 접근이 가능하다.
이 클래스가 유용하게 사용되는 곳은 헬퍼 클래스가 들어가는 곳이다. 계산기를 예로 들어보면 4가지의 연산자를 헬퍼 클래스로 만들수 있다.
그리고 연산자는 Calculator.Operation.PLUS 처럼 접근해서 사용할 수 있다.</p>

<h2 id="비정적-멤버-클래스">비정적 멤버 클래스</h2>
<p>이 클래스는 클래스 안에 또 다른 클래스가 있는 것이다. 비정적 멤버 클래스 객체와 바깥 객체와의 연결은 비정적 멤버 클래스의 객체가 만들어지는 순간에 확립되고 그 뒤에는 변경할 수 없다.
this를 사용해 바깥 객체에 대한 참조를 사용할 수 있다. 비정적 멤버 클래스는 바깥 클래스 객체 없이는 존재할 수 없다.
바깥 클래스 객체에 접근할 필요가 없는 경우 항상 static를 붙여서 정적 멤버 클래스로 만든다.
이 클래스는 어댑터를 정의할 때 많이 사용된다.</p>

<h2 id="익명-클래스">익명 클래스</h2>
<p>이 클래스는 자바의 함수 객체와 비슷하다. 한 곳에서만 사용되고 그 순간에만 객체 생성이 되기 때문이다. 이 클래스는 제약이 많다.
instanceof, 클래스 이름이 필요한 곳에는 사용할 수 없고 여러 인터페이스를 구현하는 익명 클래스는 선언할 수 없으며 인터페이스를 구현하는 동시에 특정한 클래스를 계승하는 익명 클래스도 만들 수 없다.
이 클래스는 Comparator, Runnable, Thread, TimerTask 등과 같이 함수 객체를 만들어서 사용할 때 많이 쓰인다.</p>

<h2 id="지역-클래스">지역 클래스</h2>
<p>이 클래스는 메소드안에 생성되는 클래스이다. 메소드 내부에서 필요한 기능을 설정하기위해 만드는 클래스이다.
하지만 코드의 가독성이 떨어지고 다른 방법으로도 해결할 수 있기 때문에 많이 사용되지 않는다.</p>

<h2 id="예">예</h2>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Comparator</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NestedClassPractice</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 바깥 클래스를 먼저 만들어야</span>
        <span class="c1">// 내부 클래스를 생성할 수 있다.</span>
        <span class="c1">// 사용하기위해 메모리에 올라가야 하기 때문</span>
        <span class="nc">Outer1</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Outer1</span><span class="o">();</span>
        <span class="nc">Outer1</span><span class="o">.</span><span class="na">Inner1</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="na">new</span> <span class="nf">Inner1</span><span class="o">();</span>

        <span class="n">a</span><span class="o">.</span><span class="na">outerMethod</span><span class="o">();</span>
        <span class="n">b</span><span class="o">.</span><span class="na">innerMethod</span><span class="o">();</span>

        <span class="c1">// 위와 같이 메모리에 올려서 사용할 수 있지만</span>
        <span class="c1">// static 키워드가 붙으면 클래스가 로딩될 때 static 메모리 영역에 올라가게 된다</span>
        <span class="c1">// 그래서 프로그램이 종료 될 때 까지 사라지지 않는다</span>
        <span class="c1">// static은 클래스 이름을 사용해 사용할 수 있다.</span>
        <span class="c1">// static 메모리에 할당을 받고 있기 때문</span>
        <span class="nc">Outer2</span> <span class="n">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Outer2</span><span class="o">();</span>
        <span class="nc">Outer2</span><span class="o">.</span><span class="na">Inner2</span> <span class="n">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Outer2</span><span class="o">.</span><span class="na">Inner2</span><span class="o">();</span>

        <span class="n">c</span><span class="o">.</span><span class="na">outerMethod</span><span class="o">();</span>
        <span class="n">d</span><span class="o">.</span><span class="na">innerMethod</span><span class="o">();</span>
        <span class="nc">Outer2</span><span class="o">.</span><span class="na">Inner2</span><span class="o">.</span><span class="na">staticInnerMethod</span><span class="o">();</span>

        <span class="c1">// 익명 클래스는 함수 객체로 많이 사용된다.</span>
        <span class="c1">// 일회용이 목적인 클래스</span>
        <span class="c1">// new 키워드가 사용되므로 객체가 생성되고 한 곳에서만 쓰인다</span>
        <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">arrayList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="n">arrayList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>
        <span class="n">arrayList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
        <span class="n">arrayList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="n">arrayList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
        <span class="n">arrayList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">8</span><span class="o">);</span>
        <span class="n">arrayList</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="k">new</span> <span class="nc">Comparator</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">o1</span><span class="o">,</span> <span class="nc">Integer</span> <span class="n">o2</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">o1</span> <span class="o">-</span> <span class="n">o2</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="n">localClass</span><span class="o">();</span>
    <span class="o">}</span>


    <span class="c1">// 지역 클래스</span>
    <span class="c1">// 메소드 안에서 사용되는 클래스</span>
    <span class="c1">// 메소드 내부에서 필요한 기능을 설정하기 위해 만드는 클래스</span>
    <span class="c1">// 하지만 다른 방법으로 해결할 수 있기 때문에 많이 사용되지 않는다</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1001</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">localClass</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">class</span> <span class="nc">LocalClass</span> <span class="o">{</span>
            <span class="kd">private</span> <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
            <span class="kd">private</span> <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">11</span><span class="o">;</span>

            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">c</span><span class="o">()</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">NestedClassPractice</span><span class="o">.</span><span class="na">a</span><span class="o">);</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Local Class"</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="nc">LocalClass</span> <span class="n">l</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LocalClass</span><span class="o">();</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">l</span><span class="o">.</span><span class="na">a</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">l</span><span class="o">.</span><span class="na">b</span><span class="o">);</span>
        <span class="n">l</span><span class="o">.</span><span class="na">c</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Outer1</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">a</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">outerMethod</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Outer1 Method"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">class</span> <span class="nc">Inner1</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">b</span><span class="o">;</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">innerMethod</span><span class="o">()</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Inner1 Method"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Outer2</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">a</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">b</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">outerMethod</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Outer2 Method"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Inner2</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">c</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">d</span><span class="o">;</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">innerMethod</span><span class="o">()</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Inner2 Method"</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">staticInnerMethod</span><span class="o">()</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Static Inner2 Method"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
]]></content>
      <categories>
        
          <category> Effective Java </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Effective Java] 전략을 표현하고 싶을 때는 함수 객체를 사용하라]]></title>
      <url>/effective%20java/2019/06/04/use-function-object/</url>
      <content type="html"><![CDATA[<h1 id="함수-객체">함수 객체</h1>
<p>다른 언어에서는 함수 포인터, 람다, 델리게이트 처럼 특정 함수를 호출할 수 있는 능력을 저장하고 전달할 수 있도록 하는 것들이 있다.
이러한 것들은 C언어의 qsort의 마지막 인자인 comparator에 들어갈 수 있다.
자바에서는 함수 포인터를 지원하지 않는다. 하지만 비슷하게 만들어서 효과를 볼 수 있다. 이러한 것을 자바에서는 함수 객체라고 부른다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">StringLengthComparator</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="nc">String</span> <span class="n">s1</span><span class="o">,</span> <span class="nc">String</span> <span class="n">s2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">s1</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">-</span> <span class="n">s2</span><span class="o">.</span><span class="na">length</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>위의 메소드는 문자열을 알파벳순이 아닌 길이 순으로 정렬하는 메소드이다. 위의 메소드를 사용하려면 객체 생성이 필요하지만 다음과 같이 객체 생성을 하지 않고 사용할 수 있다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">StringLengthComparator</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nf">StringLengthComparator</span><span class="o">()</span> <span class="o">{}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">StringLengthComparator</span> <span class="no">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringLengthComparator</span><span class="o">();</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="nc">String</span> <span class="n">s1</span><span class="o">,</span> <span class="nc">String</span> <span class="n">s2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">s1</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">-</span> <span class="n">s2</span><span class="o">.</span><span class="na">length</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>compare 메소드는 오직 문자열만 매개변수로 받고있다. 하지만 제네릭을 사용하면 다양한 인자를 받을 수 있게 된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Comparator</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">in</span> <span class="nf">compare</span><span class="o">(</span><span class="no">T</span> <span class="n">t1</span><span class="o">,</span> <span class="no">T</span> <span class="n">t2</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">StringLengthComparator</span> <span class="kd">implements</span> <span class="nc">Comparator</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="c1">// 위와 동일한 메소드</span>
<span class="o">}</span>

<span class="c1">// 익명 클래스로도 정의 가능</span>
<span class="nc">Arrays</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">stringArray</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Comparator</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;)</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="nc">String</span> <span class="n">s1</span><span class="o">,</span> <span class="nc">String</span> <span class="n">s2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">s1</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">-</span> <span class="n">s2</span><span class="o">.</span><span class="na">length</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
]]></content>
      <categories>
        
          <category> Effective Java </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Effective Java] 태그 달린 클래스 대신 클래스 계층을 활용하라]]></title>
      <url>/effective%20java/2019/02/11/not-use-tag-class/</url>
      <content type="html"><![CDATA[<h1 id="태그-클래스">태그 클래스</h1>
<p>하나의 클래스의 두 가지 이상의 기능이 있는 클래스를 말한다. 하지만 이와 같은 클래스는 오히려 가독성을 떨어트릴 뿐이다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Figure</span> <span class="o">{</span>
    <span class="kd">enum</span> <span class="nc">Shape</span> <span class="o">{</span> <span class="no">RECTANGLE</span><span class="o">,</span> <span class="no">CIRCLE</span> <span class="o">};</span>
    
    <span class="c1">// 어떤 모양인지 나타내는 태그 필드</span>
    <span class="kd">final</span> <span class="nc">Shape</span> <span class="n">shape</span><span class="o">;</span>
    
    <span class="c1">// 태그가 RECTANGLE일 때만 사용되는 필드들</span>
    <span class="kt">double</span> <span class="n">length</span><span class="o">;</span>
    <span class="kt">double</span> <span class="n">width</span><span class="o">;</span>
    
    <span class="c1">// 태그가 CIRCLE일 때만 사용되는 필드들</span>
    <span class="kt">double</span> <span class="n">radius</span><span class="o">;</span>
    
    <span class="c1">// 원을 만드는 생성자</span>
    <span class="nc">Figure</span><span class="o">(</span><span class="kt">double</span> <span class="n">radius</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="nc">Shape</span><span class="o">.</span><span class="na">CIRCLE</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">radius</span> <span class="o">=</span> <span class="n">radius</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="c1">// 사각형을 만드는 생성자</span>
    <span class="nc">Figure</span><span class="o">(</span><span class="kt">double</span> <span class="n">length</span><span class="o">,</span> <span class="kt">double</span> <span class="n">width</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="nc">Shape</span><span class="o">.</span><span class="na">RECTANGLE</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">length</span> <span class="o">=</span> <span class="n">length</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">width</span> <span class="o">=</span> <span class="n">width</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kt">double</span> <span class="nf">area</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">switch</span> <span class="o">(</span><span class="n">shape</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">case</span> <span class="nl">RECTANGLE:</span>
                <span class="k">return</span> <span class="n">length</span> <span class="o">*</span> <span class="n">width</span><span class="o">;</span>
            <span class="k">case</span> <span class="nl">CIRCLE:</span>
                <span class="k">return</span> <span class="nc">Math</span><span class="o">.</span><span class="na">PI</span> <span class="o">*</span> <span class="o">(</span><span class="n">radius</span> <span class="o">*</span> <span class="n">radius</span><span class="o">);</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">AssertionError</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>보이는 봐와 같이 enum과 switch문이 들어가 있고 다양한 생성자와 필드가 만들어 진걸 볼 수 있다.
이런 코드는 가독성을 떨어뜨릴고 객체가 만들어 질 때 필요하지 않은 필드까지 초기화 시키니 메모리 요구도 늘어난다.
그리고 오류 발생 가능성도 더 높고 도형이 추가 될 때 마다 이 클래스는 점점 불어 날것이다.</p>

<h1 id="수정">수정</h1>
<p>위와 같은 클래스를 다음과 같이 고칠 수 있다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Figure</span> <span class="o">{</span>
    <span class="kd">abstract</span> <span class="kt">double</span> <span class="nf">area</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Circle</span> <span class="kd">extends</span> <span class="nc">Figure</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">double</span> <span class="n">radius</span><span class="o">;</span>
    
    <span class="nc">Circle</span><span class="o">(</span><span class="kt">double</span> <span class="n">radius</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">radius</span> <span class="o">=</span> <span class="n">radius</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kt">double</span> <span class="nf">area</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Math</span><span class="o">.</span><span class="na">PI</span> <span class="o">*(</span><span class="n">radius</span> <span class="o">*</span> <span class="n">radius</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Rectangle</span> <span class="kd">extends</span> <span class="nc">Figure</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">double</span> <span class="n">length</span><span class="o">;</span>
    <span class="kd">final</span> <span class="kt">double</span> <span class="n">width</span><span class="o">;</span>
    
    <span class="nc">Rectangle</span><span class="o">(</span><span class="kt">double</span> <span class="n">length</span><span class="o">,</span> <span class="kt">double</span> <span class="n">width</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">length</span> <span class="o">=</span> <span class="n">length</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">width</span> <span class="o">=</span> <span class="n">width</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kt">double</span> <span class="nf">area</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">length</span> <span class="o">*</span> <span class="n">width</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>위에 있는 태그 기반 클래스 보다 더 읽기 쉽고 불 필요한 코드가 전부 사라졌음을 볼 수 있다. 또한 태그 기반 클래스의 단점을 모두 해결하였다.</p>
]]></content>
      <categories>
        
          <category> Effective Java </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Effective Java] 인터페이스는 자료형을 정의할 때만 사용하라]]></title>
      <url>/effective%20java/2018/12/20/define-data-type/</url>
      <content type="html"><![CDATA[<h1 id="인터페이스-사용의-부적절한-예">인터페이스 사용의 부적절한 예</h1>
<p>인터페이스는 인스턴스를 만들지는 못하지만 인터페이스 자료형으로 해당하는 인터페이스를 구현하고 있는 클래스는 모두 참조가 가능하다.
이 외의 다른 목적으로 사용은 바람직하지 않다. 그 예로 상수 인터페이스가 있다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 상수 인터페이스 안티패턴 - 사용하지 말 것!</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PhysicalConstants</span> <span class="o">{</span>
    <span class="c1">// 아보가드로 수(1 / mod)</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="kt">double</span> <span class="no">AVOGADROS_NUMBER</span> <span class="o">=</span> <span class="mf">6.02214199e23</span><span class="o">;</span>
    
    <span class="c1">// 볼쯔만 상수 (j / k)</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="kt">double</span> <span class="no">BOLTZMANN_CONSTANT</span> <span class="o">=</span> <span class="mf">1.3806503</span><span class="n">e</span><span class="o">-</span><span class="mi">23</span><span class="o">;</span>
    
    <span class="c1">// 전자 질량 (kg)</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="kt">double</span> <span class="no">ELECTRON_MASS</span> <span class="o">=</span> <span class="mf">9.10938188</span><span class="n">e</span><span class="o">-</span><span class="mi">31</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>클래스가 어떤 상수를 사용한다는 것은 구현의 세부 사항이고 클라이언트가 이를 알아둘 필요가 없다. 클라이언트를 혼란 시킬것이다.</p>

<p>이를 해결할 방법이 있다. 상수가 해당 클래스에 강하게 연결 되어 있을 경우 그 상수들을 클래스에 추가 시킨다.
Integer 클래스에 MAX_VALUE, MIN_VALUE 처럼 말이다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PhysicalConstants</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nf">PhysicalConstants</span><span class="o">()</span> <span class="o">{}</span> <span class="c1">// 객체의 생성을 막음</span>
    
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">double</span> <span class="no">AVOGADROS_NUMBER</span> <span class="o">=</span> <span class="mf">6.02214199e23</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">double</span> <span class="no">BOLTZMANN_CONSTANT</span> <span class="o">=</span> <span class="mf">1.3806503</span><span class="n">e</span><span class="o">-</span><span class="mi">23</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">double</span> <span class="no">ELECTRON_MASS</span> <span class="o">=</span> <span class="mf">9.10938188</span><span class="n">e</span><span class="o">-</span><span class="mi">31</span><span class="o">;</span> 
<span class="o">}</span>
</code></pre></div></div>
]]></content>
      <categories>
        
          <category> Effective Java </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Effective Java] 추상 클래스 대신 인터페이스를 사용하라]]></title>
      <url>/effective%20java/2018/12/11/use-interface/</url>
      <content type="html"><![CDATA[<h1 id="추상-클래스와-인터페이스">추상 클래스와 인터페이스</h1>
<p>추상 클래스는 메소드의 구현부가 포함 될 수 있지만 인터페이스는 그렇지 않다. 좀 더 큰 차이는 추상 클래스는 구현하기 위해 상속을 필요로 하지만 인터페이스는 그렇지 않기 때문에 다중상속을 만들어 낼 수 있다.</p>

<h1 id="믹스인mixin">믹스인(Mixin)</h1>
<p>인터페이스는 믹스인을 정의하는 데 이상적이다. 믹스인이란 이미 사용중이던 클래스에 쉽게 붙여서 기능을 확장하는 것을 말한다.
예를 들어 가수를 표현하는 인터페이스와 작곡가를 표현하는 인터페이스가 있다고 하자.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Singer</span> <span class="o">{</span>
    <span class="nc">AudioClip</span> <span class="nf">sing</span><span class="o">(</span><span class="nc">Song</span> <span class="n">s</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Songwriter</span> <span class="o">{</span>
    <span class="nc">Song</span> <span class="nf">compose</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">hit</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>그런데 가수 가운데는 작곡가인 사람도 있다. 추상 클래스 대신 인터페이스를 사용해 자료형을 만들었으므로, 아무런 문법적 문제없이 Singer와 Songwriter를 동시에 구현하는 클래스를 만들 수 있다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">SingerSongwriter</span> <span class="kd">extends</span> <span class="nc">Singer</span><span class="o">,</span> <span class="nc">Songwriter</span> <span class="o">{</span>
    <span class="nc">AudioClip</span> <span class="nf">strum</span><span class="o">();</span>
    <span class="kt">void</span> <span class="nf">actSensitive</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<h1 id="추상-클래스와-인터페이스의-결합">추상 클래스와 인터페이스의 결합</h1>
<p>추상 클래스와 인터페이스를 같이 사용하면 두개의 장점 모두 사용할 수 있다. 인터페이스는 자료혀을 정의하고 구현하는 일은 골격 구현 클래스에게 맡기면 된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 골격 구현 위에서 만들어진 완전한 List 구현</span>
<span class="kd">static</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="nf">intArrayAsList</span><span class="o">(</span><span class="kd">final</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">a</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">NullPointerException</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="k">return</span> <span class="k">new</span> <span class="nc">AbstractList</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
        <span class="o">}</span>
        
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">set</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">,</span> <span class="nc">Integer</span> <span class="n">val</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">oldVal</span> <span class="o">=</span> <span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
            <span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">val</span><span class="o">;</span> <span class="c1">// auto unboxing</span>
            <span class="k">return</span> <span class="n">oldVal</span><span class="o">;</span> <span class="c1">// auto boxing</span>
        <span class="o">}</span>
        
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>이미 존재하는 List 구현체가 프로그래머를 위해 어떤 일을 할 수 있ㅇㄹ지 알고 싶은 사람에게 아주 유용할 것이다. (위 코드는 성능면에서는 좋지 않다.)
골격 구현 클래스를 만드는 작업은 상대적으로 멍청해 보일지도 모르겠지만 단순한 작업이다. 우선 인터페이스를 살펴보고 다른 메서드를 구현할 때 쓸 기본 메서드들을 추려 낸다. 그리고 이 기본 메서드들을은 골격 구현 클래스에 추상 메서드로 선언하고, 나머지 메서드들은 실제로 구현해서 넣는다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 골격 구현</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">AbstractMapEntry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span> <span class="no">V</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span> <span class="no">V</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="c1">// 기본 메서드</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="no">K</span> <span class="nf">getKey</span><span class="o">();</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="no">V</span> <span class="nf">getValue</span><span class="o">();</span>
    
    <span class="c1">// 변경 가능 맵에 들어갈 Entry는 이 메서드를 재정의해야 한다.</span>
    <span class="kd">public</span> <span class="no">V</span> <span class="nf">setValue</span><span class="o">(</span><span class="no">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="c1">// Map.Entry.equals의 일반 규약 구현</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="k">this</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>
        
        <span class="k">if</span> <span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        
        <span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;?,</span> <span class="o">?&gt;</span> <span class="n">arg</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
        
        <span class="k">return</span> <span class="nf">equals</span><span class="o">(</span><span class="n">getKey</span><span class="o">(),</span> <span class="n">arg</span><span class="o">.</span><span class="na">getKey</span><span class="o">())</span> <span class="o">&amp;&amp;</span> <span class="n">equals</span><span class="o">(</span><span class="n">getValue</span><span class="o">(),</span> <span class="n">arg</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
    <span class="o">}</span>
    
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o1</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">o2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">o1</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">?</span> <span class="n">o2</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">o1</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">o2</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="c1">// Map.Entry.hashCode의 일반 규약 구현</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">hashCode</span><span class="o">(</span><span class="n">getKey</span><span class="o">())</span> <span class="o">^</span> <span class="n">hashCode</span><span class="o">(</span><span class="n">getValue</span><span class="o">());</span>
    <span class="o">}</span>
    
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">obj</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">obj</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
]]></content>
      <categories>
        
          <category> Effective Java </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Effective Java] 계승을 위한 설계와 문서를 갖추거나, 그럴 수 없다면 계승을 금지하라]]></title>
      <url>/effective%20java/2018/07/19/extends-doc/</url>
      <content type="html"><![CDATA[<h1 id="상속을-위해서는-어떤-문서를-만들어야-할까">상속을 위해서는 어떤 문서를 만들어야 할까?</h1>
<p>오버라이딩이 되는 메소드에 대해서는 내부적으로 어떻게 사용하지 문서에 남겨야한다. 좀 더 세부적으로 어떤 메소드를 호출하고 어떤 결과를 반환하는지를 명시하면 좋다.</p>

<h1 id="java-doc-example">Java Doc Example</h1>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public boolean remove(Object o)
Removes a single instance of the specified element from this collection, if it is present (optional operation). More formally, removes an element e such that (o==null ? e==null : o.equals(e)), if this collection contains one or more such elements. Returns true if this collection contained the specified element (or equivalently, if this collection changed as a result of the call).
This implementation iterates over the collection looking for the specified element. If it finds the element, it removes the element from the collection using the iterator's remove method.

Note that this implementation throws an UnsupportedOperationException if the iterator returned by this collection's iterator method does not implement the remove method and this collection contains the specified object.

Specified by:
remove in interface Collection&lt;E&gt;
Parameters:
o - element to be removed from this collection, if present
Returns:
true if an element was removed as a result of this call
Throws:
UnsupportedOperationException - if the remove operation is not supported by this collection
ClassCastException - if the type of the specified element is incompatible with this collection (optional)
NullPointerException - if the specified element is null and this collection does not permit null elements (optional)
</code></pre></div></div>

<p>java8 버전에 있는 java.util.AbstractCollection에 remove 메소드이다. 메소드에 설명을 보면 어떤 예외가 발생할 수 있는지에 대한 명시가 제대로 적혀있다.</p>
]]></content>
      <categories>
        
          <category> Effective Java </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Effective Java] 계승하는 대신 구성하라]]></title>
      <url>/effective%20java/2018/07/18/extends-wrapper/</url>
      <content type="html"><![CDATA[<h1 id="계승">계승</h1>
<p>상속을 하게 되면 코드를 재활용하고 다형성을 사용할 수 있다는 점은 좋은 이점이지만 단점이 더 많다.</p>

<h1 id="어떤-단점">어떤 단점?</h1>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">InstrumentedHashSet</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nc">HashSet</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">addCount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">InstrumentedHashSet</span><span class="o">()</span> <span class="o">{}</span>

    <span class="kd">public</span> <span class="nf">InstrumentedHashSet</span><span class="o">(</span><span class="kt">int</span> <span class="n">initCap</span><span class="o">,</span> <span class="kt">float</span> <span class="n">loadFactor</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">initCap</span><span class="o">,</span> <span class="n">loadFactor</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">add</span><span class="o">(</span><span class="no">E</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">addCount</span><span class="o">++;</span>
        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">addAll</span><span class="o">(</span><span class="nc">Collection</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="no">E</span><span class="o">&gt;</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">addCount</span> <span class="o">+=</span> <span class="n">c</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getAddCount</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">addCount</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>다음과 같이 HashSet<E> 클래스를 상속받아 데이터가 몇번 삽입 되는지 확인하는 코드가 있다. add를 사용하여 데이터를 삽입하면 정상적으로 작동하지만 다음과 같은 코드는 문제가 발생 하게 된다.</E></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">InstrumentedHashSet</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">i</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">InstrumentedHashSet</span><span class="o">&lt;&gt;();</span>
<span class="n">i</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">));</span>
</code></pre></div></div>

<p>실행하고 결과를 보면 6이라는 결과 값이 나오게 된다. 왜 그러냐면 HashSet<E>의 addAll은 add를 통해서 데이터를 삽입된다. 처음 addAll을 호출하고 addCount += c.size();를 통해 3이 증가하고 상위 클래스의 addAll를 호출해 데이터를 삽입하면 다시 add를 호출하게 되어서 addCount++ 때문에 또 증가되기 때문이다. 이처럼 상위 클래스가 어떻게 작성되었는지 정확하게 모르면 어이없는 실수를 범하게 될것이다.
또 다른 문제는 상위 클래스가 변경되면 그에 따라 하위 클래스가 제대로 작동할지 보장되지 않는다.</E></p>

<h1 id="그럼-어떻게">그럼 어떻게?</h1>
<p>새롭게 작성될 클래스에 기존 클래스를 private 멤버로 두는 것이다. 이런 설계 기법을 구성이라고 부르는데 기존 클래스가 새 클래스의 일부가 되기 때문이다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 계승 대신 구성하는 클래스</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">InstrumentedSet</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nc">ForwardingSet</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">addCount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">InstrumentedSet</span><span class="o">(</span><span class="nc">Set</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">add</span><span class="o">(</span><span class="no">E</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">addCount</span><span class="o">++;</span>
        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">addAll</span><span class="o">(</span><span class="nc">Collection</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="no">E</span><span class="o">&gt;</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">addCount</span> <span class="o">+=</span> <span class="n">c</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getAddCount</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">addCount</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// 재사용 가능한 전달 클래스</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForwardingSet</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="n">s</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">ForwardingSet</span><span class="o">(</span><span class="nc">Set</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isEmpty</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">contains</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Iterator</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="nf">iterator</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Object</span><span class="o">[]</span> <span class="nf">toArray</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="na">toArray</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="no">T</span><span class="o">[]</span> <span class="nf">toArray</span><span class="o">(</span><span class="no">T</span><span class="o">[]</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="n">a</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">add</span><span class="o">(</span><span class="no">E</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">remove</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">containsAll</span><span class="o">(</span><span class="nc">Collection</span><span class="o">&lt;?&gt;</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="na">containsAll</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">addAll</span><span class="o">(</span><span class="nc">Collection</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="no">E</span><span class="o">&gt;</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">retainAll</span><span class="o">(</span><span class="nc">Collection</span><span class="o">&lt;?&gt;</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="na">retainAll</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">removeAll</span><span class="o">(</span><span class="nc">Collection</span><span class="o">&lt;?&gt;</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="na">removeAll</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clear</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">s</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>계승을 사용하게 되면 어떤 한 클래스에서만 적용이 가능하고, 상위 클래스 생성자 마다 별도의 생성자를 만들어야 한다. 하지만 포장 클래스 기법을 사용하면 어떠한 Set 클래스에 대해 구현할 수 있고 이미 있는 생성자도 그대로 사용할 수 있다.</p>

<h1 id="그럼-상속은-언제">그럼 상속은 언제?</h1>
<p>옛날 부터 수 없이 들어 왔던 말이 있다 상속을 하기 위한 최선의 조건은 “IS-A”조건이 이다. 이 조건을 다시 한번 생각하면서 상속을 해야할지 포장을 해야할지 생각해야한다.</p>
]]></content>
      <categories>
        
          <category> Effective Java </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Effective Java] 변경 가능성을 최소화하라]]></title>
      <url>/effective%20java/2018/07/17/immutable-class/</url>
      <content type="html"><![CDATA[<h1 id="변경-불가능-클래스">변경 불가능 클래스</h1>
<p>변경 불가능 클래스는 말 그대로 내부의 정보를 수정할 수 없는 클래스이다. 객체 내부의 정보는 객체가 생성될 때 주어진 것이며 객체가 만들어 지고 없어질 때까지 변경되지 않는다. 이러한 클래스를 만드는 이유는 다양하다. 변경 가능 클래스보다 설계 및 구현 하기가 쉽고, 오류가 적으며, 사용하기도 쉽다.</p>

<h1 id="변경-불가능-클래스를-만들기-위한-규칙">변경 불가능 클래스를 만들기 위한 규칙</h1>
<ol>
  <li>객체 상태를 변경하는 메소드를 제공하지 않는다.</li>
  <li>상속하지 못하게 final로 클래스를 만든다. 상속을 받아서 클래스를 정의하게 되면 객체 상태가 변경된 것처럼 동작할 수 있기 때문이다.</li>
  <li>모든 필드를 final로 선언한다. 시스템이 강제하는 형태대로 프로그래머의 의도가 분명히 드러나고 새로 생성된 객체에 대한 참조가 동기화 없이 다른 스레드로 전달 되어도 안전하기 때문이다.</li>
  <li>모든 필드를 private로 선언한다. 이 객체를 사용하는 다른 사용자가 필드를 변경할 수 없기 때문이다.</li>
  <li>변경 가능 컴포넌트에 대한 독점적 접근권을 보장한다. 클래스에 포함된 변경 가능 객체에 대한 참조를 클라이언트는 획득할 수 없어야 한다.</li>
</ol>

<h1 id="변경-불가능-클래스-예시">변경 불가능 클래스 예시</h1>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Complex</span> <span class="o">{</span>
    <span class="c1">// 많이 사용하는 것들은 미리 만들어서 사용하는 것이 좋다</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Complex</span> <span class="no">ZERO</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Complex</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Complex</span> <span class="no">ONE</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Complex</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Complex</span> <span class="no">I</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Complex</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">double</span> <span class="n">re</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">double</span> <span class="n">im</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Complex</span><span class="o">(</span><span class="kt">double</span> <span class="n">re</span><span class="o">,</span> <span class="kt">double</span> <span class="n">im</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">re</span> <span class="o">=</span> <span class="n">re</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">im</span> <span class="o">=</span> <span class="n">im</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// 대응되는 수정자가 없는 접근자들</span>
    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">realPart</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">imginaryPart</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">im</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Complex</span> <span class="nf">add</span><span class="o">(</span><span class="nc">Complex</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Complex</span><span class="o">(</span><span class="n">re</span> <span class="o">+</span> <span class="n">c</span><span class="o">.</span><span class="na">re</span><span class="o">,</span> <span class="n">im</span> <span class="o">+</span> <span class="n">c</span><span class="o">.</span><span class="na">im</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Complex</span> <span class="nf">subtract</span><span class="o">(</span><span class="nc">Complex</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Complex</span><span class="o">(</span><span class="n">re</span> <span class="o">-</span> <span class="n">c</span><span class="o">.</span><span class="na">re</span><span class="o">,</span> <span class="n">im</span> <span class="o">-</span> <span class="n">c</span><span class="o">.</span><span class="na">im</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Complex</span> <span class="nf">multiply</span><span class="o">(</span><span class="nc">Complex</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Complex</span><span class="o">(</span><span class="n">re</span> <span class="o">*</span> <span class="n">c</span><span class="o">.</span><span class="na">re</span> <span class="o">-</span> <span class="n">im</span> <span class="o">*</span> <span class="n">c</span><span class="o">.</span><span class="na">im</span><span class="o">,</span> <span class="n">re</span> <span class="o">*</span> <span class="n">c</span><span class="o">.</span><span class="na">im</span> <span class="o">+</span> <span class="n">im</span> <span class="o">*</span> <span class="n">c</span><span class="o">.</span><span class="na">re</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Complex</span> <span class="nf">divide</span><span class="o">(</span><span class="nc">Complex</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">double</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">re</span> <span class="o">*</span> <span class="n">c</span><span class="o">.</span><span class="na">re</span> <span class="o">+</span> <span class="n">c</span><span class="o">.</span><span class="na">im</span> <span class="o">*</span> <span class="n">c</span><span class="o">.</span><span class="na">im</span><span class="o">;</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Complex</span><span class="o">((</span><span class="n">re</span> <span class="o">*</span> <span class="n">c</span><span class="o">.</span><span class="na">re</span> <span class="o">+</span> <span class="n">im</span> <span class="o">*</span> <span class="n">c</span><span class="o">.</span><span class="na">im</span><span class="o">)</span> <span class="o">/</span> <span class="n">tmp</span><span class="o">,</span> <span class="o">(</span><span class="n">im</span> <span class="o">*</span> <span class="n">c</span><span class="o">.</span><span class="na">re</span> <span class="o">-</span> <span class="n">re</span> <span class="o">*</span> <span class="n">c</span><span class="o">.</span><span class="na">im</span><span class="o">)</span> <span class="o">/</span> <span class="n">tmp</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="k">this</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="nc">Complex</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nc">Complex</span> <span class="n">c</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Complex</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>

        <span class="k">return</span> <span class="nc">Double</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">re</span><span class="o">,</span> <span class="n">c</span><span class="o">.</span><span class="na">re</span><span class="o">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nc">Double</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">im</span><span class="o">,</span> <span class="n">c</span><span class="o">.</span><span class="na">im</span><span class="o">)</span> <span class="o">==</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">17</span> <span class="o">+</span> <span class="n">hashDouble</span><span class="o">(</span><span class="n">re</span><span class="o">);</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">31</span> <span class="o">*</span> <span class="n">result</span> <span class="o">+</span> <span class="n">hashDouble</span><span class="o">(</span><span class="n">im</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">hashDouble</span><span class="o">(</span><span class="kt">double</span> <span class="n">val</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">long</span> <span class="n">longBits</span> <span class="o">=</span> <span class="nc">Double</span><span class="o">.</span><span class="na">doubleToLongBits</span><span class="o">(</span><span class="n">val</span><span class="o">);</span>
        <span class="k">return</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">longBits</span> <span class="o">^</span> <span class="o">(</span><span class="n">longBits</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">32</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"("</span> <span class="o">+</span> <span class="n">re</span> <span class="o">+</span> <span class="s">" + "</span> <span class="o">+</span> <span class="n">im</span> <span class="o">+</span> <span class="s">"i)"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<ul>
  <li>간단하게 작성된 것이며 실제로 사용하기에는 부적합할 것이다.</li>
</ul>

<h1 id="단점">단점</h1>
<p>유일한 단점은 만약 반환해야 한다면 새로운 객체를 만들어서 반환해햐 한다. 이러면 많은 메모리가 낭비 될수도 있다.</p>
]]></content>
      <categories>
        
          <category> Effective Java </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Android] Dalvik과 ART]]></title>
      <url>/android/2018/04/02/android-compile/</url>
      <content type="html"><![CDATA[<h1 id="dalvik">Dalvik</h1>
<ul>
  <li>구글의 댄 본스타인이 만든 VM</li>
  <li>Java는 JVM위에서 실행되고, Android Dalvik위에서 실행된다.</li>
  <li>Android 5.0 이하에서만 사용되고 그 이상 버전은 ART로 교체되었다.</li>
  <li>Dalvik에서는 JIT(Just In Time)컴파일러를 사용하였다.</li>
</ul>

<h1 id="jit">JIT</h1>
<ul>
  <li>처음 실행될 때 한번 컴파일하고 그 뒤에 자주 쓰이는 코드는 캐시에 저장하고 가져다 쓴다. 인터프리터의 느린 실행 속도를 개선할 수 있었다.</li>
  <li>하지만 처음 컴파일 단계에서 모든 코드를 메모리에 올려두고 작업해야 하기 때문에 메모리 소비가 많다</li>
</ul>

<h1 id="art">ART</h1>
<ul>
  <li>Dalvik의 한계점을 개선한 새로운 런타임</li>
  <li>앱을 설치할 때 완전히 네이티브 코드로 변환하여 설치한다.</li>
  <li>JIT대신 AOT 컴파일을 사용한다.</li>
</ul>

<h1 id="aot">AOT</h1>
<ul>
  <li>AOT는 중간 언어로 배포된 후 플랫폼에 맞계 기계어로 미리 번역하는 방식</li>
  <li>JIT는 실행 시점에서 컴파일을 수행하는데 추가적인 메모리와 CPU 사이클이 필요한데, 이를 보완하는 방법으로 사용될수 있다.</li>
  <li>설치 속도가 Dalvik보다 느리고 공간도 많이 차이한다.</li>
  <li>처음 설치할 때 컴파일 작업을 다 해놓기 때문에 생기는 근본적인 한계</li>
  <li>Android 5.0이하에서 개발된 어플들이 제대로 동작하지 못할 때도 있다.</li>
</ul>
]]></content>
      <categories>
        
          <category> Android </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[pattern] Observer Pattern]]></title>
      <url>/pattern/2018/04/02/observer-pattern/</url>
      <content type="html"><![CDATA[<h1 id="observer-pattern">Observer Pattern</h1>
<p>어떤 클래스에 변화가 있을 때 변화를 알려주는 패턴</p>

<h1 id="코드">코드</h1>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">Observer</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="nc">String</span> <span class="n">title</span><span class="o">,</span> <span class="nc">String</span> <span class="n">news</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">Publisher</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="nc">Observer</span> <span class="n">observer</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="nc">Observer</span> <span class="n">observer</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">notifyObserver</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">NewsMachine</span> <span class="kd">implements</span> <span class="nc">Publisher</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Observer</span><span class="o">&gt;</span> <span class="n">observers</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">news</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">NewsMachine</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">observers</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Observer</span><span class="o">&gt;();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="nc">Observer</span> <span class="n">observer</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">observers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">observer</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="nc">Observer</span> <span class="n">observer</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">observers</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="n">observer</span><span class="o">);</span>
        <span class="n">observers</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">index</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">notifyObserver</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Observer</span> <span class="n">observer</span> <span class="o">:</span> <span class="n">observers</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">observer</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">title</span><span class="o">,</span> <span class="n">news</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setNewsInfo</span><span class="o">(</span><span class="nc">String</span> <span class="n">title</span><span class="o">,</span> <span class="nc">String</span> <span class="n">news</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">news</span> <span class="o">=</span> <span class="n">news</span><span class="o">;</span>
        <span class="n">notifyObserver</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">title</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getNews</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">news</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">AnnualSubscriber</span> <span class="kd">implements</span> <span class="nc">Observer</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">newsString</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Publisher</span> <span class="n">publisher</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">AnnualSubscriber</span><span class="o">(</span><span class="nc">Publisher</span> <span class="n">publisher</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">publisher</span> <span class="o">=</span> <span class="n">publisher</span><span class="o">;</span>
        <span class="n">publisher</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="nc">String</span> <span class="n">title</span><span class="o">,</span> <span class="nc">String</span> <span class="n">news</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">newsString</span> <span class="o">=</span> <span class="n">title</span> <span class="o">+</span> <span class="s">"\n"</span> <span class="o">+</span> <span class="n">news</span> <span class="o">+</span> <span class="s">"\n"</span><span class="o">;</span>
        <span class="n">display</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">display</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"annual user : today news "</span> <span class="o">+</span> <span class="n">newsString</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">EventSubscriber</span> <span class="kd">implements</span> <span class="nc">Observer</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">newsString</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Publisher</span> <span class="n">publisher</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">EventSubscriber</span><span class="o">(</span><span class="nc">Publisher</span> <span class="n">publisher</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">publisher</span> <span class="o">=</span> <span class="n">publisher</span><span class="o">;</span>
        <span class="n">publisher</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="nc">String</span> <span class="n">title</span><span class="o">,</span> <span class="nc">String</span> <span class="n">news</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">newsString</span> <span class="o">=</span> <span class="n">title</span> <span class="o">+</span> <span class="s">"\n"</span> <span class="o">+</span> <span class="n">news</span> <span class="o">+</span> <span class="s">"\n"</span><span class="o">;</span>
        <span class="n">display</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">withdraw</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">publisher</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">display</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"event user : today news "</span> <span class="o">+</span> <span class="n">newsString</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ObserverPattern</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">NewsMachine</span> <span class="n">newsMachine</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NewsMachine</span><span class="o">();</span>
        <span class="nc">AnnualSubscriber</span> <span class="n">as</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AnnualSubscriber</span><span class="o">(</span><span class="n">newsMachine</span><span class="o">);</span>
        <span class="nc">EventSubscriber</span> <span class="n">es</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">EventSubscriber</span><span class="o">(</span><span class="n">newsMachine</span><span class="o">);</span>

        <span class="n">newsMachine</span><span class="o">.</span><span class="na">setNewsInfo</span><span class="o">(</span><span class="s">"오늘 뉴스"</span><span class="o">,</span> <span class="s">"화창한 날씨"</span><span class="o">);</span>
        <span class="n">newsMachine</span><span class="o">.</span><span class="na">setNewsInfo</span><span class="o">(</span><span class="s">"오늘 온도"</span><span class="o">,</span> <span class="s">"소풍가기 좋은 날"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h1 id="참조">참조</h1>
<ul>
  <li>http://flowarc.tistory.com/entry/%EB%94%94%EC%9E%90%EC%9D%B8-%ED%8C%A8%ED%84%B4-%EC%98%B5%EC%A0%80%EB%B2%84-%ED%8C%A8%ED%84%B4Observer-Pattern</li>
</ul>
]]></content>
      <categories>
        
          <category> Pattern </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Android] JNI 사용하기]]></title>
      <url>/android/2018/03/31/android-jni/</url>
      <content type="html"><![CDATA[<h1 id="예제-코드">예제 코드</h1>
<ul>
  <li>https://github.com/KimBoWoon/Android-Practice/tree/master/JNI</li>
</ul>

<h1 id="오류-수정">오류 수정</h1>
<ul>
  <li>jar 파일을 만들 때 gradle 명령어를 조심히 사용하자</li>
  <li>jar 파일을 만들고 나서 확인해보니 <code class="language-plaintext highlighter-rouge">libs.com.android.~</code> 로 시작해서 클래스를 못찾은거 같다</li>
  <li>인터넷에서 본 exportJar 라는 gradle task가 안된다.</li>
  <li><code class="language-plaintext highlighter-rouge">build/intermediates/bundle</code>라는 폴더가 생성이 안되서 command line으로 실행</li>
</ul>

<h1 id="jnijava-native-interface-란">JNI(Java Native Interface) 란</h1>
<ul>
  <li>자바가 다른 언어들과 상호작용을 할 수 있도록 도와주는 인터페이스</li>
  <li>자바로 구현하기에는 성능이 많이 떨어진다고 생각되면 JNI를 사용해 구현할 수 있다</li>
  <li>다른 하드웨어를 제어하기위해 사용하기도 함</li>
  <li>C/C++를 사용</li>
</ul>

<h1 id="example">Example</h1>
<ol>
  <li>안드로이드 Empty Activity 프로젝트를 만든다.</li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">sdk tools</code>에서 CMake와 LLDB, NDK를 설치한다.</p>

    <p><img src="https://raw.githubusercontent.com/KimBoWoon/KimBoWoon.github.io/master/_img/android/sdk-setting.png" alt="그림" /></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">File -&gt; New Module</code>를 선택한다.</p>

    <p><img src="https://raw.githubusercontent.com/KimBoWoon/KimBoWoon.github.io/master/_img/android/new-module.png" alt="그림" /></p>
  </li>
  <li>
    <p>android library를 선택한다.</p>

    <p><img src="https://raw.githubusercontent.com/KimBoWoon/KimBoWoon.github.io/master/_img/android/android-library.png" alt="그림" /></p>
  </li>
  <li>
    <p>android library를 생성하고 난 뒤에 <code class="language-plaintext highlighter-rouge">File -&gt; Setting</code>에 <code class="language-plaintext highlighter-rouge">Tool -&gt; ExternalTool</code>을 다음과 같이 설정한다.</p>

    <p><img src="https://raw.githubusercontent.com/KimBoWoon/KimBoWoon.github.io/master/_img/android/setting.png" alt="그림" /></p>
    <ul>
      <li>javah
        <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  program : javah.exe
  argument : -classpath "$Classpath$" -v -jni $FileClass$
  working directory : $ProjectFileDir$\&lt;라이브러리 이름&gt;\src\main\jni
</code></pre></div>        </div>
      </li>
      <li>NDK-Build
        <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  program : ndk-build.cmd
  working directory : $ProjectFileDir$\&lt;라이브러리 이름&gt;\src\main
</code></pre></div>        </div>
      </li>
      <li>NDK-Clean
        <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  program : ndk-build.cmd
  argument : clean
  working directory : $ProjectFileDir$\&lt;라이브러리 이름&gt;\src\main
</code></pre></div>        </div>
      </li>
      <li><code class="language-plaintext highlighter-rouge">javah.exe</code> : java class 대로 Header File을 만들어준다. 설치된 jdk에 bin에 존재한다.</li>
      <li><code class="language-plaintext highlighter-rouge">ndk-build.cmd</code> : C/C++로 작성된 코드를 인터페이스에 맞게 build 시켜준다. 설치된 android-sdk에 ndk-bundle에 존재한다.(2번에 NDK를 설치하면 생성됨)</li>
      <li>각각의 환경변수가 설정되어 있지 않으면 절대경로를 넣어 설정한다.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">src -&gt; main</code> 아래에 jni폴더를 생성한다. NDK-Build를 진행하게 되면 여기에 <code class="language-plaintext highlighter-rouge">*.so</code>파일이 생성된다.</li>
  <li>
    <p>이제 자신의 패키지명 아래에 java class를 생성한다. class에는 메소드만 선언해주고 나중에 <code class="language-plaintext highlighter-rouge">javah.exe</code>를 사용하면 jni폴더 아래에 헤더 파일이 생성된다.</p>

    <p><img src="https://raw.githubusercontent.com/KimBoWoon/KimBoWoon.github.io/master/_img/android/create-class.png" alt="그림" /></p>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">System.loadLibrary()</code>은 전달인자와 같은 이름의 모듈을 로드시킨다는 의미</li>
      <li>나중에 mk 파일에서 LOCAL_MODULE의 이름을 적어주면 된다.</li>
    </ul>
  </li>
  <li>
    <p>class를 만들고 난 뒤에 <code class="language-plaintext highlighter-rouge">javah.exe</code>를 실행한다. 단, 먼저 빌드가 되어 있어야 순조롭게 진행된다.</p>

    <p><img src="https://raw.githubusercontent.com/KimBoWoon/KimBoWoon.github.io/master/_img/android/make-project.png" alt="그림" /></p>

    <p><img src="https://raw.githubusercontent.com/KimBoWoon/KimBoWoon.github.io/master/_img/android/error-javah.png" alt="그림" /></p>
    <ul>
      <li>실패 했을 때</li>
    </ul>

    <p><img src="https://raw.githubusercontent.com/KimBoWoon/KimBoWoon.github.io/master/_img/android/success-javah.png" alt="그림" /></p>
    <ul>
      <li>성공 했을 때</li>
    </ul>
  </li>
  <li>
    <p>지금은 참조를 제대로 못하고 있지만 Link를 해주면 정상적으로 참조를 하게 된다.</p>

    <p><img src="https://raw.githubusercontent.com/KimBoWoon/KimBoWoon.github.io/master/_img/android/c-header.PNG" alt="그림" /></p>
  </li>
  <li>Android.mk와 Application.mk 파일을 만들어 준다.
    <ul>
      <li>LOCAL_MODULE := (원하는 module 이름)</li>
      <li>FILES := (나중에 만들 cpp file 이름)</li>
      <li>APP_ABI := all : android cpu가 지원하는 모든 ABI에 대해 <code class="language-plaintext highlighter-rouge">*.so</code> 파일을 만든다.</li>
    </ul>

    <p><img src="https://raw.githubusercontent.com/KimBoWoon/KimBoWoon.github.io/master/_img/android/create-mk-file.PNG" alt="그림" /></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Link C++ Project With Gradle</code>을 진행한다.</p>

    <p><img src="https://raw.githubusercontent.com/KimBoWoon/KimBoWoon.github.io/master/_img/android/link.png" alt="그림" /></p>

    <p><img src="https://raw.githubusercontent.com/KimBoWoon/KimBoWoon.github.io/master/_img/android/mk-build-gradle.PNG" alt="그림" /></p>
    <ul>
      <li>위와 같이 <code class="language-plaintext highlighter-rouge">build.gradle</code>에 mk 파일의 경로가 추가된걸 볼 수 있다.</li>
    </ul>
  </li>
  <li>
    <p>이제 jni 폴더 아래에 cpp 파일을 만들어 원하는대로 구현한다.</p>

    <p><img src="https://raw.githubusercontent.com/KimBoWoon/KimBoWoon.github.io/master/_img/android/make-csource.png" alt="그림" /></p>

    <p><img src="https://raw.githubusercontent.com/KimBoWoon/KimBoWoon.github.io/master/_img/android/create-cpp.PNG" alt="그림" /></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ndk-build</code>를 실행한다. 실행하면 다음과 같이 모든 ABI에 대해 <code class="language-plaintext highlighter-rouge">*.so</code> 파일이 만들어진것을 볼수있다.</p>

    <p><img src="https://raw.githubusercontent.com/KimBoWoon/KimBoWoon.github.io/master/_img/android/excute-ndk-build.png" alt="그림" /></p>

    <p><img src="https://raw.githubusercontent.com/KimBoWoon/KimBoWoon.github.io/master/_img/android/after-excute-ndk-build.PNG" alt="그림" /></p>
  </li>
  <li>
    <p>만들어둔 java class에 대해서는 jar 파일을 만들어야 연동이 가능하다. jar파일이 없으면 해당하는 메소드를 찾을 수 없다고 오류가 발생한다. <code class="language-plaintext highlighter-rouge">build.gradle</code>에 다음과 같은 task를 넣는다.</p>

    <p><img src="https://raw.githubusercontent.com/KimBoWoon/KimBoWoon.github.io/master/_img/android/export-jar.PNG" alt="그림" /></p>
  </li>
  <li>
    <p>gradle 창에 other으로 가면 exportJar가 생성된걸 볼 수 있고 실행하면 jar파일이 만들어진것을 볼 수 있다.</p>

    <p><img src="https://raw.githubusercontent.com/KimBoWoon/KimBoWoon.github.io/master/_img/android/export-jar-gradle.PNG" alt="그림" /></p>
  </li>
  <li>이제 이걸 사용하려면 원하는 프로젝트에 <code class="language-plaintext highlighter-rouge">app -&gt; libs</code>에 jar 파일을 넣고 <code class="language-plaintext highlighter-rouge">src -&gt; main -&gt; jniLibs</code>에 <code class="language-plaintext highlighter-rouge">&lt;abi name&gt;/*.so</code>를 넣고 <code class="language-plaintext highlighter-rouge">build.gradle</code>에 <code class="language-plaintext highlighter-rouge">implementation files('libs/(만들어둔 jar 파일 이름))</code>을 넣으면 사용이 가능하다.</li>
</ol>

<h1 id="실행-결과">실행 결과</h1>
<p><img src="https://raw.githubusercontent.com/KimBoWoon/KimBoWoon.github.io/master/_img/android/complate.png" alt="그림" /></p>

<ul>
  <li>x와 y를 더한 값을 반환하는 JNI Library를 만들었고 Toast로 결과값을 확인</li>
</ul>

<h1 id="참조">참조</h1>
<ul>
  <li>https://developer.android.com/studio/projects/android-library.html?hl=ko</li>
  <li>http://duzi077.tistory.com/134</li>
</ul>
]]></content>
      <categories>
        
          <category> Android </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Effective Java] public 클래스 안에는 public 필드를 두지 말고 접근자 메소드를 사용하라]]></title>
      <url>/effective%20java/2017/12/19/geter-seter/</url>
      <content type="html"><![CDATA[<h1 id="접근자-메소드">접근자 메소드</h1>
<p>어느 클래스는 필드만 가지고 있는 클래스가 있다. 이 클래스에는 접근자 메소드가 있어야 여러모로 좋다. 캡슐화의 이점을 누릴 수 없고 API를 변경하지 않고서는 내부 표현을 변경할 수도 없다. 또한 불변식도 강제할 수 없고, 필드를 사용하는 순간에 어떤 종작이 실행되록 만들 수도 없다. 그래서 다음과 같이 접근자 메소드를 가져야한다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Point</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kt">double</span> <span class="n">x</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">double</span> <span class="n">y</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="nf">Point</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">,</span> <span class="kt">double</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
    	<span class="k">this</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="nf">getX</span><span class="o">()</span> <span class="o">{</span>
    	<span class="k">return</span> <span class="n">x</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="nf">getY</span><span class="o">()</span> <span class="o">{</span>
    	<span class="k">return</span> <span class="n">y</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="nf">setX</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
    	<span class="k">this</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="nf">setY</span><span class="o">(</span><span class="kt">double</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
    	<span class="k">this</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>이렇게 만들어야 클래스 내부표현을 자유로이 수정할 수 있게 된다.</p>
]]></content>
      <categories>
        
          <category> Effective Java </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Effective Java] 클래스와 멤버의 접근 권한은 최소화하라]]></title>
      <url>/effective%20java/2017/12/15/java-access/</url>
      <content type="html"><![CDATA[<h1 id="정보은닉과-캡슐화">정보은닉과 캡슐화</h1>
<p>잘 설계된 모듈과 그렇지 못한 모듈을 구별하는 방법 중에 하나는 모듈 내부의 데이터를 비롯한 여러 구현 세부사항을 다른 모듈에 잘 감추느냐의 여부다. 잘 설계된 모듈을 모두 API 뒤편으로 감춘다. 그리고 모듈은 API를 통해서만 서로 통신한다. 또한 내부적으로는 무슨 짓을 하는지는 신경 쓰지 않는다. 이 개념이 바로 정보은닉과 캡슐화이다. 정보은닉은 여러모로 중요하다. 대부분이 정보은닉이 시스템을 구성하는 모듈 사이의 의존성을 낮춰서 각자 개별적으로 개발하고 시험하고 최적화하고 이해하고 변경할 수 있도록 한다는 사실에 기초한다. 그렇게 되면 병렬적으로 개발할 수 있기 때문에 개발 속도가 올라간다. 이러한 장점을 지키위해서 행해야 하는것은 정말 간단하다. 각 클래스의 멤버는 가능한 한 접근 불가능하도록 만들면 된다.</p>

<h1 id="java-접근자">java 접근자</h1>
<ul>
  <li>private : 최상위 레벨 클래스 내부에서만 접근 가능</li>
  <li>package-private : 간은 패키지 내의 아무 클래스나 사용 가능, 기본 접근 권한으로 알려져 있다.</li>
  <li>protected : 해당하는 클래스와 이 클래스를 상속받은 클래스들 내에서 사용이 가능하다.</li>
  <li>public : 언제 어디서는 사용이 가능하다.</li>
</ul>

<p>public은 항상 조심해야한다. 스레드에도 안전하지 않고 누구나 접근이 가능해서 값이 변경되기 때문이다. 또한 길이가 0이 아닌 배열은 언제나 변경 가능하므로, public static final 배열 필드를 두거나, 배열 필드를 반환하는 접근자를 정의하면 안 된다. 클라이언트가 배열 내용을 변경할 수 있기 때문에 보안에 문제가 생긴다. 따라서 다음과 같이 사용하는게 좋다.</p>

<p>public으로 선언되었던 배열은 private로 바꾸고, 변경이 불가능한 public 리스트를 하나 만드는 것이다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Integer</span><span class="o">[]</span> <span class="no">PRIVATE_VALUES</span> <span class="o">=</span> <span class="o">{};</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="no">VALUES</span> <span class="o">=</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">unmodifiableList</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="no">PRIVATE_VALUES</span><span class="o">));</span>
</code></pre></div></div>

<p>배열은 private 으로 선언하고, 해당 배열을 복사해서 반환하는 public 메소드를 하나 추가하는 것이다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Integer</span><span class="o">[]</span> <span class="no">PRIVATE_VALUES</span> <span class="o">=</span> <span class="o">{};</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Integer</span><span class="o">[]</span> <span class="nf">values</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="no">PRIVATE_VALUES</span><span class="o">.</span><span class="na">clone</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>두 방법 가운데 하나를 택할 때는 클라이언트가 어떤 작업을 하길 원하는지 따져야 한다.</p>
]]></content>
      <categories>
        
          <category> Effective Java </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Effective Java] Comparable 구현을 고려하라]]></title>
      <url>/effective%20java/2017/12/14/comparable-implement/</url>
      <content type="html"><![CDATA[<h1 id="comparable">Comparable</h1>
<p>이 인터페이스는 다른 인터페이스와 달리 하나의 메소드를 가지고 있다. compareTo 메소들을 가지고 있는데 이 메소드는 Object 클래스에는 포함되어 있지 않으며 오직 Comparable만이 가지고 있다. Comparable을 구현하는 클래스의 객체들은 모두 자연적 순서를 가지고 있다. 또한 최대/최소치를 계산하기도 간단하며, 그 컬렉션을 정렬된 상태로 유지하도 쉽다. 그리고 다양한 제네릭 알고리즘 및 Comparable 인터페이스를 이용하도록 작성된 컬렉션 구현체와도 전부 연동할 수 있다.</p>

<h1 id="compareto-메소드의-일반-규약">compareTo 메소드의 일반 규약</h1>
<ul>
  <li>자신과 주어진 객체를 비교하는데 자신이 주어진 객체보다 작으면 음수를, 같으면 0, 크다면 양수를 반환한다. 만약 비교 불가능한 객체가 전달된다면 ClassCastException 예외를 던진다.</li>
  <li>모든 x와 y에 대해 x.compareTo(y) == y.compareTo(x)는 같아야 한다. 만약 예외를 던진다면 역도 반드시 그래야한다.</li>
  <li>compareTo를 구현할 때는 추이성이 만족되도록 해야한다. (x.compareTo(y) &gt; 0 &amp;&amp; y.compareTo(z) &gt; 0 이면 x.compareTo(z) &gt; 이어야한다.)</li>
  <li>x.compareTo(y) == 0 이면 x.compareTo(z) == y.compareTo(z)의 관계가 모든 z에 대해 성립해야한다.</li>
  <li>(x.compareTo(y) == 0) == x.equals(y) 이 규약은 강력히 추천하지만 절대적으로 요구되는 것이 아니다. 일반적으로, Compareable 인터페이스를 구현하면서 이 조건을 만족하지 않는 클래스는 반드시 그 사실을 명시해야한다.</li>
</ul>

<p>이 규약들은 모두 한 클래스 객체 사이에 자연적 순서가 존재하기만 하면 어떤 것이든 이 규약을 만족할 것이다.</p>

<h1 id="코드">코드</h1>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ComparablePractice</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Fruit</span><span class="o">[]</span> <span class="n">fruits</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Fruit</span><span class="o">[</span><span class="mi">5</span><span class="o">];</span>

        <span class="n">fruits</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Fruit</span><span class="o">(</span><span class="s">"사과"</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span>
        <span class="n">fruits</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Fruit</span><span class="o">(</span><span class="s">"오렌지"</span><span class="o">,</span> <span class="mi">34</span><span class="o">);</span>
        <span class="n">fruits</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Fruit</span><span class="o">(</span><span class="s">"포도"</span><span class="o">,</span> <span class="mi">24</span><span class="o">);</span>
        <span class="n">fruits</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Fruit</span><span class="o">(</span><span class="s">"배"</span><span class="o">,</span> <span class="mi">19</span><span class="o">);</span>
        <span class="n">fruits</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Fruit</span><span class="o">(</span><span class="s">"키위"</span><span class="o">,</span> <span class="mi">37</span><span class="o">);</span>

        <span class="nc">Arrays</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">fruits</span><span class="o">);</span>

        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">fruits</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">getName</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"----------------------------"</span><span class="o">);</span>

        <span class="nc">Arrays</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">fruits</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Comparator</span><span class="o">&lt;</span><span class="nc">Fruit</span><span class="o">&gt;()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="nc">Fruit</span> <span class="n">o1</span><span class="o">,</span> <span class="nc">Fruit</span> <span class="n">o2</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">o2</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">compareTo</span><span class="o">(</span><span class="n">o1</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">fruits</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">getName</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Fruit</span> <span class="kd">implements</span> <span class="nc">Comparable</span><span class="o">&lt;</span><span class="nc">Fruit</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">price</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Fruit</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">price</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">price</span> <span class="o">=</span> <span class="n">price</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getPrice</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">price</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPrice</span><span class="o">(</span><span class="kt">int</span> <span class="n">price</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">price</span> <span class="o">=</span> <span class="n">price</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="nc">Fruit</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<ul>
  <li>compareTo 메소드에서 사용자가 원하는 값을 기준으로 정렬해야한다.</li>
</ul>

<h1 id="comparable와-comparator-차이">Comparable와 Comparator 차이</h1>
<p>서로 같은일을 하는 인터페이스지만 왜 따로 존재하냐면 Comparable는 자기 자신과 다른 객체 하나를 비교하고 Comparator은 다른 두개의 객체를 비교한다. Comparator 인터페이스를 구현한 객체를 기준으로 다른 두개의 객체를 비교한다는 말이다.</p>
]]></content>
      <categories>
        
          <category> Effective Java </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Effective Java] clone을 재정의 할 때는 신중하라]]></title>
      <url>/effective%20java/2017/12/12/cloneable-implement/</url>
      <content type="html"><![CDATA[<h1 id="cloneable-interface">Cloneable Interface</h1>
<p>Cloneable은 어떤 객체가 복제를 허용한다는 사실을 알리는 데 쓰려고 만들어진 믹스인(mixin) 인터페이스다. 이 인터페이스는 아무런 추상 메소드들을 가지고 있지 않고 오직 Object 클래스의 clone을 사용할것인지 여부를 결정하기만 한다. clone 메소드를 호출하면 해당하는 객체의 복사본을 만들어낸다. 또한 원본객체와 같은 필드값을 가지며 필드의 값도 복사된다. 이 인터페이스를 implement를 하지않고 clone메소드를 호출하면 CloneNotSupportedException을 뱉어낸다.</p>

<h1 id="clone-메소드의-일반-규약">clone 메소드의 일반 규약</h1>
<ul>
  <li>x.clone() != x</li>
  <li>x.clone().getClass() == x.getClass()</li>
  <li>x.clone.equals(x)</li>
</ul>

<p>이 규약들은 참이여야 하지만 꼭 그렇지만도 않다.</p>

<h1 id="clone-override">clone override</h1>
<p>final이 아닌 슈퍼 클래스를 오버라이딩할 경우 반드시 서브 클래스에서 super.clone()을 호출하여 얻은 객체를 반환하야 한다. 그리고 해당하는 객체를 복사할 때 레퍼런스 타입을 가지고 있는 경우에는 레퍼런스 타입에도 clone 메소드를 호출해야한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Stack</span> <span class="kd">implements</span> <span class="nc">Cloneable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Object</span><span class="o">[]</span> <span class="n">elements</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">DEFAULT_INITIAL_CAPACITY</span> <span class="o">=</span> <span class="mi">16</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Stack</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">elements</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[</span><span class="no">DEFAULT_INITIAL_CAPACITY</span><span class="o">];</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">push</span><span class="o">(</span><span class="nc">Object</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ensureCapacity</span><span class="o">();</span>
        <span class="n">elements</span><span class="o">[</span><span class="n">size</span><span class="o">++]</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">pop</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">EmptyStackException</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="nc">Object</span> <span class="n">result</span> <span class="o">=</span> <span class="n">elements</span><span class="o">[--</span><span class="n">size</span><span class="o">];</span>
        <span class="n">elements</span><span class="o">[</span><span class="n">size</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">ensureCapacity</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">elements</span><span class="o">.</span><span class="na">length</span> <span class="o">==</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">elements</span><span class="o">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">size</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Stack</span> <span class="nf">clone</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Stack</span> <span class="n">result</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Stack</span><span class="o">)</span> <span class="kd">super</span><span class="o">.</span><span class="na">clone</span><span class="o">();</span>
            <span class="n">result</span><span class="o">.</span><span class="na">elements</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="na">clone</span><span class="o">();</span>
            <span class="k">return</span>  <span class="n">result</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">CloneNotSupportedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">AssertionError</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<ul>
  <li>clone 메소드에서 super를 사용해서 얻어온 객체는 형변환을 해서 넣지만 elements는 clone 메소드을 호출한 결과 그대로 넣고있다. 릴리즈 1.5부터는 배열에 clone을 호출하면 반환되는 배열의 컴파일 시점 자료형은 복제 대상 배열의 자료형과 같기 때문이다.</li>
  <li>clone 메소드는 동기화를 지원하지 않는다. 원한다면 따로 구현야해할 것이다.</li>
  <li>clone 을 사용해 꼭 모두 복사할 필요가 없다. 다른 값을 가지고 싶은 필드가 있다면 clone 메소드에서 따로 설정하는게 좋다.</li>
  <li>clone의 아키텍처는 변경 가능한 객체를 참조하는 final 필드의 일반적 용법과 호환되지 않는다. 따라서 final 선언을 지워야 할 수도 있다.</li>
  <li>깊은 복사를 진행할 때 재귀보다는 loop를 사용하는게 좋다. Stack Overflow가 발생할 수 있기 때문이다.</li>
  <li>Cloneable 인터페이스를 구현하는 클래스는 제대로 동작하는 public clone 메소드를 제공해야한다.</li>
</ul>

<p>사실 clone 메소드를 많이 사용하지 않는다. 굳이 사용해야 한다면 제대로 구현해야할 것이다.</p>
]]></content>
      <categories>
        
          <category> Effective Java </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[pattern] Strategy Pattern]]></title>
      <url>/pattern/2017/12/11/strategy-pattern/</url>
      <content type="html"><![CDATA[<h1 id="strategy-pattern">Strategy Pattern</h1>
<p>필요한 알고리즘을 캡슐화 시켜서 상황에 맞게 사용하는 방법</p>

<h1 id="코드">코드</h1>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StrategyPatternPractice</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Tiger</span> <span class="n">tiger</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Tiger</span><span class="o">(</span><span class="s">"Tiger"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Walk</span><span class="o">());</span>
        <span class="nc">Bird</span> <span class="n">bird</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Bird</span><span class="o">(</span><span class="s">"Bird"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Fly</span><span class="o">());</span>

        <span class="n">tiger</span><span class="o">.</span><span class="na">doMove</span><span class="o">();</span>
        <span class="n">bird</span><span class="o">.</span><span class="na">doMove</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<ul>
  <li>알고리즘 인스턴스를 만들어 생성자로 넘겨준다</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">Move</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="nf">move</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>
<ul>
  <li>캡슐화 알고리즘을 만들기 위해 인터페이스를 정의</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Fly</span> <span class="kd">implements</span> <span class="nc">Move</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">move</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"Fly"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Walk</span> <span class="kd">implements</span> <span class="nc">Move</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">move</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"Walk"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<ul>
  <li>인터페이스를 상속 받아 각각의 알고리즘을 구현한다</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Tiger</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Move</span> <span class="n">move</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Tiger</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">Move</span> <span class="n">move</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">move</span> <span class="o">=</span> <span class="n">move</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doMove</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">move</span><span class="o">.</span><span class="na">move</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Bird</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Move</span> <span class="n">move</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Bird</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">Move</span> <span class="n">move</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">move</span> <span class="o">=</span> <span class="n">move</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doMove</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">move</span><span class="o">.</span><span class="na">move</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<ul>
  <li>해당하는 클래스 마다 생성자에서 인터페이스로 캐스팅시켜서 할당한다</li>
</ul>
]]></content>
      <categories>
        
          <category> Pattern </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[pattern] Adapter Pattern]]></title>
      <url>/pattern/2017/12/09/adapter-pattern/</url>
      <content type="html"><![CDATA[<h1 id="adapter-pattern">Adapter Pattern</h1>
<p>약간의 차이가 있는 클래스들을 인터페이스를 통해 똑같은 기능으로 사용하는 방법</p>

<h1 id="코드">코드</h1>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">MyEngine</span> <span class="n">engine</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyEngine</span><span class="o">();</span>

    <span class="n">engine</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
    <span class="n">engine</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
    <span class="n">engine</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>
    <span class="n">engine</span><span class="o">.</span><span class="na">printAll</span><span class="o">();</span>
    <span class="n">engine</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
    <span class="n">engine</span><span class="o">.</span><span class="na">printAll</span><span class="o">();</span>
    <span class="n">engine</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
    <span class="n">engine</span><span class="o">.</span><span class="na">printAll</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">AEngine</span> <span class="n">aEngine</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AEngine</span><span class="o">();</span>

    <span class="n">engine</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
    <span class="n">engine</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
    <span class="n">engine</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">engine</span><span class="o">.</span><span class="na">getSize</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="n">engine</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
    <span class="n">engine</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">engine</span><span class="o">.</span><span class="na">getSize</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="n">engine</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
    <span class="n">engine</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">engine</span><span class="o">.</span><span class="na">getSize</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="n">engine</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>
<ul>
  <li>기존에 사용하던 엔진에서 다른 엔진을 사용하려면 그에 맞게 코드를 수정할 필요가 있을것이다.</li>
  <li>
    <p>이대로라면 유지보수가 불편해질것이다.</p>
  </li>
  <li>그래서 다음과 같이 인터페이스를 만들고 그것을 구현한다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">EngineInterface</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">);</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">printAll</span><span class="o">();</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="kt">int</span> <span class="n">data</span><span class="o">);</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">);</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getSize</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">AdapterEngine</span> <span class="kd">implements</span> <span class="nc">EngineInterface</span> <span class="o">{</span>
    <span class="nc">AEngine</span> <span class="n">engine</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">AdapterEngine</span><span class="o">(</span><span class="nc">AEngine</span> <span class="n">engine</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">engine</span> <span class="o">=</span> <span class="n">engine</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">engine</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">index</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">printAll</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">engine</span><span class="o">.</span><span class="na">getSize</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">engine</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="kt">int</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">engine</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">engine</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">index</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getSize</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">engine</span><span class="o">.</span><span class="na">getSize</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<ul>
  <li>
    <p>두 클래스가 제공하는 모든 기능이 들어있음을 알 수 있다.</p>
  </li>
  <li>
    <p>결과적으론 다음과 같이 변경되지 않은 코드를 사용할 수 있다.</p>
  </li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">AEngine</span> <span class="n">aEngine</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AEngine</span><span class="o">();</span>
    <span class="nc">EngineInterface</span> <span class="n">engine</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AdapterEngine</span><span class="o">(</span><span class="n">aEngine</span><span class="o">);</span>

    <span class="n">engine</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
    <span class="n">engine</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
    <span class="n">engine</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>
    <span class="n">engine</span><span class="o">.</span><span class="na">printAll</span><span class="o">();</span>
    <span class="n">engine</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
    <span class="n">engine</span><span class="o">.</span><span class="na">printAll</span><span class="o">();</span>
    <span class="n">engine</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
    <span class="n">engine</span><span class="o">.</span><span class="na">printAll</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>
]]></content>
      <categories>
        
          <category> Pattern </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[pattern] Iterator Pattern]]></title>
      <url>/pattern/2017/12/08/iterator-pattern/</url>
      <content type="html"><![CDATA[<h1 id="iterator-pattern">Iterator Pattern</h1>
<p>for나 while를 대신하여 사용할 수 있는 도구</p>

<h1 id="코드">코드</h1>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">IteratorPattern</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">integers</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;();</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">integers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="n">integers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
        <span class="n">integers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>
        <span class="n">integers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">4</span><span class="o">);</span>
        <span class="n">integers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>

        <span class="nc">Iterator</span> <span class="n">iterator</span> <span class="o">=</span> <span class="n">integers</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>

        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">integers</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">integers</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="k">while</span> <span class="o">(</span><span class="n">iterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">iterator</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<ul>
  <li>여기서 for나 while를 사용할 수 있지만 iterator를 사용하는 이유는 유지보수가 편하고, 만약 컬렉션이나 다른 클래스를 사용한다 하여도 반복문은 바뀌지 않기 때문입니다.</li>
</ul>
]]></content>
      <categories>
        
          <category> Pattern </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[pattern] Factory Pattern]]></title>
      <url>/pattern/2017/12/07/factory-pattern/</url>
      <content type="html"><![CDATA[<h1 id="factory-pattern">Factory Pattern</h1>
<p>클래스의 생성을 다른 클래스의에 위임하는 것</p>

<h1 id="코드">코드</h1>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FactoryPatternPractice</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Book</span> <span class="n">mathBook</span> <span class="o">=</span> <span class="nc">FactoryPattern</span><span class="o">.</span><span class="na">createClass</span><span class="o">(</span><span class="s">"math"</span><span class="o">);</span>
        <span class="nc">Book</span> <span class="n">historyBook</span> <span class="o">=</span> <span class="nc">FactoryPattern</span><span class="o">.</span><span class="na">createClass</span><span class="o">(</span><span class="s">"history"</span><span class="o">);</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">mathBook</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">historyBook</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">Book</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="nf">getName</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">MathBook</span> <span class="kd">implements</span> <span class="nc">Book</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"MathBook"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">HistoryBook</span> <span class="kd">implements</span> <span class="nc">Book</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"HistoryBook"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">FactoryPattern</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Book</span> <span class="nf">createClass</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">switch</span> <span class="o">(</span><span class="n">name</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">case</span> <span class="s">"math"</span><span class="o">:</span>
                <span class="k">return</span> <span class="k">new</span> <span class="nf">MathBook</span><span class="o">();</span>
            <span class="k">case</span> <span class="s">"history"</span><span class="o">:</span>
                <span class="k">return</span> <span class="k">new</span> <span class="nf">HistoryBook</span><span class="o">();</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h1 id="장단점">장단점</h1>
<ul>
  <li>객체 생성 코드를 전부 한 객체 또는 메소드에 집어넣으면 코드에 중복되는 내용을 제거할 수 있다.</li>
  <li>유지보수에도 편하다.</li>
  <li>인터페이스 바탕으로 프로그래밍을 할 수 있다.</li>
  <li>생성할 객체의 종류가 달라질 때마다 새로운 클래스를 만들어야 한다. 이것은 불 필요하게 많은 클래스를 만들어낼 수 있다.</li>
</ul>
]]></content>
      <categories>
        
          <category> Pattern </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[pattern] Singleton Pattern 잘쓰기]]></title>
      <url>/pattern/2017/12/06/singleton-pattern/</url>
      <content type="html"><![CDATA[<h1 id="eager-initialization">Eager Initialization</h1>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">EagerInitialization</span> <span class="o">{</span>
    <span class="c1">// private static 로 선언.</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">EagerInitialization</span> <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">EagerInitialization</span><span class="o">();</span>

    <span class="c1">// 생성자</span>
    <span class="kd">private</span> <span class="nf">EagerInitialization</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"call EagerInitialization constructor."</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// 조회 method</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">EagerInitialization</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"It's print() method in EagerInitialization instance."</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"instance hashCode &gt; "</span> <span class="o">+</span> <span class="n">instance</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<ul>
  <li>private 접근제어자 때문에 이 인스턴스를 접근해서 사용하려면 getInstance() 메소드를 사용해야한다.</li>
  <li>다른 클래스들이 이 클래스를 많이 사용하면 아마도 클래스가 로드되는 시점에서 인스턴스를 생성시키는데 무리가 있을 수 있다.</li>
  <li>이 클래스의 인스턴스를 만들어 주는 과정에서 어떠한 예외 처리도 할 수 없다.</li>
</ul>

<h1 id="static-block-initialization">Static Block Initialization</h1>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">StaticBlockInitialization</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">StaticBlockInitialization</span> <span class="n">instance</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nf">StaticBlockInitialization</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="kd">static</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"instance create.."</span><span class="o">);</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StaticBlockInitialization</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"Exception creating StaticBlockInitialization instance."</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">StaticBlockInitialization</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"It's print() method in StaticBlockInitialization instance."</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"instance hashCode &gt; "</span> <span class="o">+</span> <span class="n">instance</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<ul>
  <li>static 초기화블럭을 이용하면 클래스가 로딩 될 때 최초 한번 실행하게 된다.</li>
  <li>초기화블럭을 이용하면 logic을 담을 수 있기 때문에 복잡한 초기변수 셋팅이나 위와 같이 에러처리를 위한 구문을 담을 수 있다.</li>
  <li>인스턴스가 사용되는 시점에 생성되는 것은 아니다.</li>
</ul>

<h1 id="lazy-initialization">lazy initialization</h1>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">LazyInitialization</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">LazyInitialization</span> <span class="n">instance</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nf">LazyInitialization</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">LazyInitialization</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LazyInitialization</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"It's print() method in LazyInitialization instance."</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"instance hashCode &gt; "</span> <span class="o">+</span> <span class="n">instance</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<ul>
  <li>new LazyInitialization(); 는 getInstance() method 안에서 사용되었다. if문을 이용해 instance가 null 인 경우에만 new를 사용해 객체를 생성한다.</li>
  <li>최초 사용시점에만 인스턴스화 시키기 때문에 프로그램이 메모리에 적재되는 시점에 부담이 많이 줄게된다.</li>
  <li>만약 프로그램이 muilti thread 방식이라면 위와 같은 singleton pattern은 안전하지 않다.</li>
</ul>

<h1 id="thread-safe-initalization">Thread Safe Initalization</h1>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">ThreadSafeInitalization</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">ThreadSafeInitalization</span> <span class="n">instance</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nf">ThreadSafeInitalization</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">synchronized</span> <span class="nc">ThreadSafeInitalization</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ThreadSafeInitalization</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"It's print() method in ThreadSafeInitalization instance."</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"instance hashCode &gt; "</span> <span class="o">+</span> <span class="n">instance</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<ul>
  <li>muilit thread문제를 해결하기 위해 synchronized(동기화)를 사용하여 singleton pattern을 구현했다.</li>
  <li>수 많은 thread 들이 getInstance() method 를 호출하게 되면 높은 cost 비용으로 인해 프로그램 전반에 성능저하가 일어난다.</li>
</ul>

<h1 id="initialization-on-demand-holder-idiom">Initialization On Demand Holder Idiom</h1>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">InitializationOnDemandHolderIdiom</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nf">InitializationOnDemandHolderIdiom</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Singleton</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">InitializationOnDemandHolderIdiom</span> <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">InitializationOnDemandHolderIdiom</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">InitializationOnDemandHolderIdiom</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"create instance"</span><span class="o">);</span>
        <span class="k">return</span> <span class="nc">Singleton</span><span class="o">.</span><span class="na">instance</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"InitializationOnDemandHolderIdiom"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<ul>
  <li>jvm 의 class loader의 매커니즘과 class의 load 시점을 이용하여 내부 class를 생성시킴으로 thread 간의 동기화 문제를 해결한다.</li>
  <li>initialization on demand holder idiom 역시 lazy initialization이 가능하며 모든 java 버젼과, jvm에서 사용이 가능하다.</li>
  <li>java 에서 singleton 을 생성시킨다고 하면 거의 위의 방법을 사용한다고 보면 된다.</li>
</ul>

<h1 id="enum-initialization">Enum Initialization</h1>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">enum</span> <span class="nc">EnumInitialization</span> <span class="o">{</span>
    <span class="no">INSTANCE</span><span class="o">;</span>
    <span class="kd">static</span> <span class="nc">String</span> <span class="n">test</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">EnumInitialization</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">test</span> <span class="o">=</span> <span class="s">"test"</span><span class="o">;</span>
        <span class="k">return</span> <span class="no">INSTANCE</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<ul>
  <li>INSTANCE 가 생성될 때, multi thread 로 부터 안전하다. (추가된 methed 들은 safed 하지 않을 수도 있다.)</li>
  <li>단 한번의 인스턴스 생성을 보장한다.</li>
  <li>사용이 간편하다.</li>
  <li>enum value는 자바 프로그램 전역에서 접근이 가능하다.</li>
</ul>

<h1 id="using-reflection-to-destroy-singleton">Using Reflection To Destroy Singleton</h1>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">UsingReflectionToDestroySingleton</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">EagerInitialization</span> <span class="n">instance</span> <span class="o">=</span> <span class="nc">EagerInitialization</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
        <span class="nc">EagerInitialization</span> <span class="n">instance2</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Constructor</span><span class="o">[]</span> <span class="n">constructors</span> <span class="o">=</span> <span class="nc">EagerInitialization</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getDeclaredConstructors</span><span class="o">();</span>
            <span class="k">for</span> <span class="o">(</span><span class="nc">Constructor</span> <span class="n">constructor</span> <span class="o">:</span> <span class="n">constructors</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">constructor</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
                <span class="n">instance2</span> <span class="o">=</span> <span class="o">(</span><span class="nc">EagerInitialization</span><span class="o">)</span> <span class="n">constructor</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>

        <span class="o">}</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">instance</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">instance2</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<ul>
  <li>위의 코드를 실행해보면 아래 System.out.println();의 두 라인에서 찍히는 hachCode()값이 다른 것을 확인 할 수 있다.</li>
  <li>java의 reflection은 매우 강력하다. 설령 class 의 생성자가 private 일지라도 강제로 가져와서 새로운 인스턴스 생성이 가능하다.</li>
  <li>결국 singleton pattern을 깨뜨리는 것이다. 이 외에도 reflection을 여러곳에서 사용할 수 있으니 알아두는 것이 좋다.</li>
</ul>

<h1 id="참고">참고</h1>
<ul>
  <li>https://blog.seotory.com/post/2016/03/java-singleton-pattern</li>
</ul>
]]></content>
      <categories>
        
          <category> Pattern </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Effective Java] toString는 항상 재정의하라]]></title>
      <url>/effective%20java/2017/12/04/tostring-override/</url>
      <content type="html"><![CDATA[<h1 id="tostring-메소드">toString() 메소드</h1>
<p>java.lang.Object 클래스가 toString를 메소드를 제공한다. 이 메소드의 반환값은 클래스이름 다음에 @을 붙이고 다음에 16진수로 표시된 해시 코드가 반환된다. 이 값은 사용자에게 유용한 정보를 제공하지 않는다. toString를 재정의 해서 사용자들이 알아볼 수 있도록 해야한다.</p>

<h1 id="왜-어디에-사용되길래">왜? 어디에 사용되길래</h1>
<p>toString 메소드는 println, printf, 문자열 연결 연산자, assert, 디버거 등에 객체가 전달되면 자동으로 호출된다. 그리고 여러 프로그래머들은 해당하는 클래스에 대한 정보를 toString를 사용해 정보를 얻으려고 할것이다. 그래서 우리는 toString 메소드를 적절하게 구현해야한다.</p>

<h1 id="어떻게">어떻게?</h1>
<p>객체내에 중요한 정보를 모두 담아 반환해야한다. 만약 전화번호를 담당하는 클래스면 해당 국가 번호, 전화번호, 지역번호등 중요한 정보는 모두 담겨야한다. 그리고 해당클래스에 주석으로 어떠한 값이 반환되는지 적어두면 다른 사용자가 알아보기가 더 쉽다.</p>
]]></content>
      <categories>
        
          <category> Effective Java </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Effective Java] equals를 재정의할 때는 반드시 hashCode도 재정의하라]]></title>
      <url>/effective%20java/2017/12/01/hashcode-override/</url>
      <content type="html"><![CDATA[<h1 id="equals를-재정의할-때는-반드시-hashcode도-재정의하라">equals를 재정의할 때는 반드시 hashCode도 재정의하라</h1>
<p>equals 메소드가 같은 객체라는 것을 확인하더라고 hashCode가 다르면 hash로 만들어진 다른 자료구조에서 null이라는 값을 보낸다. 이처럼 hashCode를 재정의 하지 않음으로서 많은 오류가 생길 수 있다.</p>

<h1 id="문제점">문제점</h1>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HashCodeOverride</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">PhoneNumber</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">PhoneNumber</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;();</span>
        <span class="n">m</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="k">new</span> <span class="nc">PhoneNumber</span><span class="o">(</span><span class="mi">707</span><span class="o">,</span> <span class="mi">867</span><span class="o">,</span> <span class="mi">5309</span><span class="o">),</span> <span class="s">"Jenny"</span><span class="o">);</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="k">new</span> <span class="nc">PhoneNumber</span><span class="o">(</span><span class="mi">707</span><span class="o">,</span> <span class="mi">867</span><span class="o">,</span> <span class="mi">5309</span><span class="o">)));</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">final</span> <span class="kd">class</span> <span class="nc">PhoneNumber</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">short</span> <span class="n">areaCode</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">short</span> <span class="n">prefix</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">short</span> <span class="n">lineNumber</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">PhoneNumber</span><span class="o">(</span><span class="kt">int</span> <span class="n">areaCode</span><span class="o">,</span> <span class="kt">int</span> <span class="n">prefix</span><span class="o">,</span> <span class="kt">int</span> <span class="n">lineNumber</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">rangeCheck</span><span class="o">(</span><span class="n">areaCode</span><span class="o">,</span> <span class="mi">999</span><span class="o">,</span> <span class="s">"area code"</span><span class="o">);</span>
        <span class="n">rangeCheck</span><span class="o">(</span><span class="n">prefix</span><span class="o">,</span> <span class="mi">999</span><span class="o">,</span> <span class="s">"prefix"</span><span class="o">);</span>
        <span class="n">rangeCheck</span><span class="o">(</span><span class="n">lineNumber</span><span class="o">,</span> <span class="mi">9999</span><span class="o">,</span> <span class="s">"lineNumber"</span><span class="o">);</span>

        <span class="k">this</span><span class="o">.</span><span class="na">areaCode</span> <span class="o">=</span> <span class="o">(</span><span class="kt">short</span><span class="o">)</span> <span class="n">areaCode</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">prefix</span> <span class="o">=</span> <span class="o">(</span><span class="kt">short</span><span class="o">)</span> <span class="n">prefix</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">lineNumber</span> <span class="o">=</span> <span class="o">(</span><span class="kt">short</span><span class="o">)</span> <span class="n">lineNumber</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">rangeCheck</span><span class="o">(</span><span class="kt">int</span> <span class="n">arg</span><span class="o">,</span> <span class="kt">int</span> <span class="n">max</span><span class="o">,</span> <span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">arg</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">arg</span> <span class="o">&gt;</span> <span class="n">max</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">": "</span> <span class="o">+</span> <span class="n">arg</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="k">this</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="nc">PhoneNumber</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="nc">PhoneNumber</span> <span class="n">pn</span> <span class="o">=</span> <span class="o">(</span><span class="nc">PhoneNumber</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">pn</span><span class="o">.</span><span class="na">lineNumber</span> <span class="o">==</span> <span class="n">lineNumber</span> <span class="o">&amp;&amp;</span> <span class="n">pn</span><span class="o">.</span><span class="na">prefix</span> <span class="o">==</span> <span class="n">prefix</span> <span class="o">&amp;&amp;</span> <span class="n">pn</span><span class="o">.</span><span class="na">areaCode</span> <span class="o">==</span> <span class="n">areaCode</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">17</span><span class="o">;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">31</span> <span class="o">*</span> <span class="n">result</span> <span class="o">+</span> <span class="n">areaCode</span><span class="o">;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">31</span> <span class="o">*</span> <span class="n">result</span> <span class="o">+</span> <span class="n">prefix</span><span class="o">;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">31</span> <span class="o">*</span> <span class="n">result</span> <span class="o">+</span> <span class="n">lineNumber</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>여기서 사용한 PhoneNumber 객체는 두가지 이다. 하나는 put 메소드에 사용하고 다른 하나는 get 함수에 사용했다. hashCode가 재정의가 안되어 있으면 논리적으로 같은 객체라 하더라도 null값을 반환할것이다. 그렇기 때문에 hashCode를 꼭 재정의 해야한다.</p>

<h1 id="어떻게-오버라이딩을-해야할까">어떻게 오버라이딩을 해야할까?</h1>
<p>hashCode를 완벽하게 재정의 하는 법은 없다. 없다기 보다는 아직까지 확실한 연구결과가 나오지 않았다. 그렇기 때문에 제곱법이나 제산법, 폴딩법등이 있다.</p>
]]></content>
      <categories>
        
          <category> Effective Java </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Effective Java] equals를 재정의할 때는 일반 규약을 따르라]]></title>
      <url>/effective%20java/2017/11/30/equals-override/</url>
      <content type="html"><![CDATA[<h1 id="equals를-재정의할-때는-일반-규약을-따르라">equals를 재정의할 때는 일반 규약을 따르라</h1>
<p>equals 메서드는 재정의하기 쉬워 보이지만 실수할 여지가 많고 이로인한 결과는 끔찍하다. 이런 문제는 equals를 재정의 하지않는것도 방법이긴 하지만 이 경우에는 오직 자기 자신하고만 같은객체가 된다. 다음과 같은 경우에는 그래도 된다.</p>

<ol>
  <li>각각의 객체가 고유하다.
 값 대신 활성 개체를 나타내는 thread 같은 클래스가 이 조건에 부합한다. 이런 클래스는 object 의 equals 메서드를 그대로 사용해도 된다.</li>
  <li>클래스에 “논리적 동일성” 검사 방법이 있건 없건 상관없다.
 같은 난수열을 만드는지 검사하는 equals 메서드를 재정의 할 수도 있었지만 클라이언트가 그런 기능을 원할거라 생각하지 않아서 만들지 않았다.</li>
  <li>상위 클래스에서 재정의한 equals가 하위 클래스에서 사용하기에도 적당하다.
 예를들어 set, map, list 클래스는 상위 클래스의 equals를 그대로 사용한다.</li>
  <li>클래스가 private 또는 package-private로 선언되었고, equals메서드를 호출할 일이 없다.
 이런 경우에도 equals를 재정의 하는게 맞다. 실수로도 호출할 수 있기 때문이다.</li>
</ol>

<h1 id="그렇다면-바람직한-재정의는">그렇다면 바람직한 재정의는?</h1>
<p>객체 동일성이 아닌 논리적 동일성의 개념을 지원하는 클래스일 때, 그리고 상위 클래스의 equals가 하위 클래스의 필요를 충족하지 못할 때 재정의해야 한다. equals 메서드를 정의할 때 준수해야 하는 일반 규약은 다음과 같다.</p>

<ol>
  <li>반사성
 null이 아닌 참조 x가 있을 때, x.equals(x)는 true를 반환한다.</li>
  <li>대칭성
 null이 아닌 참조 x와 y가 있을 때. x.equals(y)는 y.equals(x)가 true일 때만 true를 반환한다.</li>
  <li>추이성
 null이 아닌 참조 x, y, z가 있을 때, x.equals(y)가 true이고 y.equals(z)가 ture이면 x.equals(z)도 true이다.</li>
  <li>일관성
 null이 아닌 참조 x와 y가 있을 때, equals를 통해 비교되는 정보에 아무 변화가 없다면, x.equals(y) 호출 결과는 호출 횟수에 상관없이 항상 같아야 한다.</li>
  <li>null이 아닌 참조 x에 대해서, x.equals(null)은 항상 false이다.</li>
</ol>

<p>이것을 동치 관계라고 하는대 사소한 것이지만 이것을 지키지 않아서 나오는 손해는 엄청날 것이다. 그래서 이러한 규칙들을 가지고 equals 메서드를 구현하기 위해 따라야 할 지침들은 다음과 같다.</p>

<ol>
  <li>== 연산자를 사용하여 equals의 인자가 자기 자신인지 검사하라.</li>
  <li>instanceof 연산자를 사용하여 인자의 자료형이 정확한지 검사하라.</li>
  <li>equals의 인자를 정확한 자료형으로 변환하라.</li>
  <li>“중요” 필드 각각이 인자로 주어진 객체의 해당 필드와 일치하는지 검사한다.</li>
  <li>equals 메서드 구현을 끝냈다면, 대칭성, 추이성, 일관성의 세속이 만족되는지 검토하라.</li>
</ol>
]]></content>
      <categories>
        
          <category> Effective Java </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Effective Java] 종료자 사용을 피하라]]></title>
      <url>/effective%20java/2017/10/03/not-use-finalizer/</url>
      <content type="html"><![CDATA[<h1 id="종료자finalizer은-불필요하다">종료자(finalizer)은 불필요하다</h1>
<p>C나 C++ 사용자라면 소멸자를 많이들 사용한다. 다 사용한 자원들을 반환하기 위해서 사용하는데 java에서는 종료자(finalizer)의 사용을 피하는 것이 좋다. 종료자를 사용하면 시스템 오류, 성능 오류, 이식성 문제가 발생할 가능성이 크다. 또 종료자를 사용하면 프로그램의 성능이 급격하게 떨어진다. JVM은 모든 참조가 사라지기 전까지 종료자의 실행을 미루기 때문이다. 그래서 긴급하게 종료가 필요한 것을 종료자 안에 두면 언제 종료될지 모른다.</p>

<h1 id="그럼-어떻게">그럼 어떻게?</h1>
<p>종료자 대신에 명시적인 종료 메소드를 추가하면 된다. 한 가지 명심해야할 점은 유효하지 않은 객체임을 표시하는 private 필드를 하나두고 맨 앞에서 유효한지 아닌지 검사한다. 이런 명시적인 종료 메소드는 try-finally문과 함께 쓰인다. 객체 종료를 보장하기 위해서이다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Foo</span> <span class="n">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Foo</span><span class="o">(...);</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="c1">// foo로 해야 하는 작업 수행</span>
<span class="o">}</span> <span class="n">fanally</span> <span class="o">{</span>
    <span class="n">foo</span><span class="o">.</span><span class="na">terminate</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<h1 id="정말-종료자는-불필요한가">정말 종료자는 불필요한가?</h1>
<p>적당한 곳이 두 군데 있긴하다. 종료 메소드의 호출을 잊었을 경우에 종료자안에 넣어둔다. 종료자는 그런 자원을 발견하게 될 경우 반드시 경고 메시지를 로그로 남겨야 한다. 네이티브 피어(native peer)와 연결된 객체를 다룰 때다. 네이티브 피어는 일반 자바 객체가 네이티브 메서드를 통해 기능 수행을 위임하는 네이티브 객체를 말한다. 네이티브 피어는 일반 객체가 아니므로, 쓰레기 수집기가 알 수 없을 뿐더러 자바 측 피어 객체가 반환될 때 같이 반환할 수도 없다.</p>

<h1 id="주의할-점">주의할 점</h1>
<p>종료자 연결이 자동으로 이루어지지 않는다. 상속으로 클래스를 구현할 경우 하위 클래스의 종료자는 상위 클래스의 종료자를 명시적으로 호출해야 한다. 이때 하위 클래스의 상태는 try 블록 안에서 종료시켜야 하고, 상위 클래스 종료자는 finally블록 안에서 호출해야 한다. 하위 클래스에서 상위 클래스 종료자를 재정의 하면서 상위 클래스 종료자 호출을 잊으면 상위 클래스 종료자는 절대로 호출되지 않는다.</p>
]]></content>
      <categories>
        
          <category> Effective Java </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Effective Java] 유효기간이 지난 객체는 폐기 하라]]></title>
      <url>/effective%20java/2017/10/03/object-reference/</url>
      <content type="html"><![CDATA[<h1 id="유효기간이-지난-객체는-폐기-하라">유효기간이 지난 객체는 폐기 하라</h1>
<p>메모리를 손수 관리 해주는 C와 C++을 쓰다가 쓰레기 수집기가 있는 언어를 사용하게 되면 정말 편해진다. 편해짐에 따라 메모리 관리를 하지 않아도 쓰레기 수집기가 알아서 해준다는 생각은 하면 안된다. Stack 클래스를 예로 들어보자.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyStack</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Object</span><span class="o">[]</span> <span class="n">elements</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">DEFAULT_INITAL_CAPACITY</span> <span class="o">=</span> <span class="mi">16</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="nf">MyStack</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[</span><span class="no">DEFAULT_INITAL_CAPACITY</span><span class="o">];</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">push</span><span class="o">(</span><span class="nc">Object</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ensureCapacity</span><span class="o">();</span>
        <span class="n">elements</span><span class="o">[</span><span class="n">size</span><span class="o">++]</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">pop</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">EmptyStackException</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">elements</span><span class="o">[--</span><span class="n">size</span><span class="o">];</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 적어도 하나 이상의 원소를 담을 공간을 보장한다.
     * 배열의 길이를 늘려야 할 때마다 대략 두 배씩 늘인다.
     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">ensureCapacity</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">elements</span><span class="o">.</span><span class="na">length</span> <span class="o">==</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">elements</span><span class="o">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">size</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>뚜렷하게 보이는 오류는 없지만 메모리 누수(memory leak)문제가 있다. 그래서 쓰레기 수집기가 해야할 일이 늘어나 성능이 저하되거나, 메모리 요구향이 증가할 것이다. 극단적인 경우에는 디스크 페이징(disk paging)이 발생하고 심지어는 OutOfMemoryError가 던져지면서 프로그램이 중단될 것이다. 그렇다면 저기서 메모리 누수는 어디서 생길까? pop하는 부분에서 스택이 줄어들면서 제거한 객체들을 쓰레기 수집기가 처리하지 못해서 생긴다. 스택이 그런 객체에 대한 만기 참조(obsolete reference)를 제거하지 않기 때문이다. 이런 문제는 간단히 고칠 수 있다. 쓸 일 없는 객체 참조는 무조건 null로 만드는 것이다. Stack클래스의 경우, 스택에서 pop된 객체에 대한 참조는 그 즉시 null로 만들면 된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">Object</span> <span class="nf">pop</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">EmptyStackException</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="nc">Object</span> <span class="n">results</span> <span class="o">=</span> <span class="n">elements</span><span class="o">[--</span><span class="n">size</span><span class="o">];</span>
    <span class="n">elements</span><span class="o">[</span><span class="n">size</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">results</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>만기 참조를 null로 만들면 나중에 실수로 그 참조를 사용하더라도 NullPointerException이 발생하기 때문에 프로그램은 오동작하는 대신 바로 종료된다는 장점이 있다. 프로그램의 오류는 최대한 빨리 알아내는 것이 좋다. 이런 오류를 몇 번 접하고 나면 객체 사용이 끝나면 즉시 그 참조를 null로 만들어야 한다는 강박관념에 사로잡히는 경우가 있다. 하지만 그럴필요도 없고 바람직하지도 않다. 객체 참조를 null 처리하는 것은 규범(norm)이라기보단 예외적인 조치가 되어야 한다. 만기 참조를 제거하는 가장 좋은 방법은 해당 잠조가 보관된 변수가 유효범위(scope)를 벗어나게 두는 것이다. 변수를 정의할 때 그 유효범위를 최대한 좁게 만들면 자연 스럽게 해결된다.</p>

<p>메모리 누수가 흔히 발생하는 곳은 캐시(chche)나 리스너(listener)등 이다. 메모리 누수가 보통 뚜렷한 오류로 이어지지 않고 눈에도 잘 안띄기 때문에 코딩할 때 각별한 주의가 필요하다.</p>
]]></content>
      <categories>
        
          <category> Effective Java </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Effective Java] 불필요한 객체는 만들지 말라]]></title>
      <url>/effective%20java/2017/09/27/unnecessary-object/</url>
      <content type="html"><![CDATA[<h1 id="불필요한-객체는-만들지-말라">불필요한 객체는 만들지 말라</h1>
<p>기능적으로 객체를 새로 만드는 것보다 재사용하는 편이 훨씬 빠르다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="s">"Hello, World"</span><span class="o">);</span>
</code></pre></div></div>
<p>이런식으로 객체를 만들면 호출 될 때마다 항상 새로운 객체가 만들어지기 때문에 이러한 방법은 피하는 편이 좋고 아래와 같은 방법을 쓰는것이 좋다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">s</span> <span class="o">=</span> <span class="s">"Hello, World"</span><span class="o">;</span>
</code></pre></div></div>

<p>실제로 다음과 같은 코드를 실행시키면 다음과 같은 결과를 얻는다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ImmutableObject</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="s">"Hello, World"</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="s">"Hello, World"</span><span class="o">);</span>

        <span class="nc">String</span> <span class="n">c</span> <span class="o">=</span> <span class="s">"Hello, World"</span><span class="o">;</span>
        <span class="nc">String</span> <span class="n">d</span> <span class="o">=</span> <span class="s">"Hello, World"</span><span class="o">;</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">c</span> <span class="o">==</span> <span class="n">d</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><img src="/_img/effectivejava/string_address.png" alt="" /></p>

<p>변경 불가능한 객체인 경우 정적 팩토리 메소드를 사용하면 새로운 객체를 만들지 않는다. 변경 가능한 객체도 재사용할 수 있다. 단, 변경하지 않는다면 말이다. 다음의 예를 보자</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Date</span> <span class="n">birthDate</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isBabyBoomer</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">Calendar</span> <span class="n">gmtCal</span> <span class="o">=</span> <span class="nc">Calendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="nc">TimeZone</span><span class="o">.</span><span class="na">getTimeZone</span><span class="o">(</span><span class="s">"GMT"</span><span class="o">));</span>

        <span class="n">gmtCal</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="mi">1946</span><span class="o">,</span> <span class="nc">Calendar</span><span class="o">.</span><span class="na">JANUARY</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
        <span class="nc">Date</span> <span class="n">boomStart</span> <span class="o">=</span> <span class="n">gmtCal</span><span class="o">.</span><span class="na">getTime</span><span class="o">();</span>
        <span class="n">gmtCal</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="mi">1965</span><span class="o">,</span> <span class="nc">Calendar</span><span class="o">.</span><span class="na">JANUARY</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
        <span class="nc">Date</span> <span class="n">boomEnd</span> <span class="o">=</span> <span class="n">gmtCal</span><span class="o">.</span><span class="na">getTime</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">birthDate</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">boomStart</span><span class="o">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">birthDate</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">boomEnd</span><span class="o">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>이렇게 만들면 해당 메소드를 호출될 때마다 Calendar 객체 하나, TimeZone 객체 하나, 그리고 Date 객체 두 개를 쓸데없이 만들어 낸다. 이렇게 비효율적인 코드는 정적 초기화 블록(static initializer)을 통해 개선하는 것이 좋다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Date</span> <span class="n">birthDate</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Date</span> <span class="no">BOOM_START</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Date</span> <span class="no">BOOM_END</span><span class="o">;</span>
    
    <span class="kd">static</span> <span class="o">{</span>
        <span class="nc">Calendar</span> <span class="n">gmtCal</span> <span class="o">=</span> <span class="nc">Calendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="nc">TimeZone</span><span class="o">.</span><span class="na">getTimeZone</span><span class="o">(</span><span class="s">"GMT"</span><span class="o">));</span>
        <span class="n">gmtCal</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="mi">1946</span><span class="o">,</span> <span class="nc">Calendar</span><span class="o">.</span><span class="na">JANUARY</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
        <span class="no">BOOM_START</span> <span class="o">=</span> <span class="n">gmtCal</span><span class="o">.</span><span class="na">getTime</span><span class="o">();</span>
        <span class="n">gmtCal</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="mi">1965</span><span class="o">,</span> <span class="nc">Calendar</span><span class="o">.</span><span class="na">JANUARY</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
        <span class="no">BOOM_END</span> <span class="o">=</span> <span class="n">gmtCal</span><span class="o">.</span><span class="na">getTime</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isBabyBoomer</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">birthDate</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="no">BOOM_START</span><span class="o">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">birthDate</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="no">BOOM_END</span><span class="o">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>이 클래스는 클래스가 초기화 될 때 한 번만 만든다. 그리고 BOOM_START와 BOOM_END가 한번만 초기화 되는 상수라는 사실도 알수있다. 또 객체 자료형보다 기본 자료형을 사용하는 것이 좋다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Integer</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span>
<span class="c1">// Integer i = new Integer(3);</span>
</code></pre></div></div>
<p>auto-boxing이 되면서 불필요한 객체를 만들기 때문이다.</p>
]]></content>
      <categories>
        
          <category> Effective Java </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Effective Java] 객체 생성을 막을 때는 private 생성자를 사용하라]]></title>
      <url>/effective%20java/2017/09/24/private-constructor/</url>
      <content type="html"><![CDATA[<h1 id="객체-생성을-막을-때는-private-생성자를-사용하라">객체 생성을 막을 때는 private 생성자를 사용하라</h1>
<p>코딩을 하다 보면 상수나 배열 등을 모아둔 유틸리티 클래스를 만들 때도 있다. 이러한 클래스들은 객체가 생성되면 안된다. 생성자를 만들지 않으면 컴파일러가 public 생성자를 넣기 때문에 안되고 abstract로 만들면 이 클래스를 상속받는 하위 클래스들을 사용해서 객체를 만들 수 있기 때문에 안된다. 그래서 private 생성자를 두어 객체 생성을 막는다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PrivateConstructor</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nf">PrivateConstructor</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">AssertionError</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
]]></content>
      <categories>
        
          <category> Effective Java </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Effective Java] private 생성자나 enum 자료형은 싱글턴 패턴을 따르도록 설계하라]]></title>
      <url>/effective%20java/2017/09/23/private-enum-singleton-pattern/</url>
      <content type="html"><![CDATA[<h1 id="private-생성자나-enum-자료형은-싱글턴-패턴을-따르도록-설계하라">private 생성자나 enum 자료형은 싱글턴 패턴을 따르도록 설계하라</h1>
<p>싱글턴 패턴은 객체를 하나만 만들 수 있는 클래스이다. 창 관리자나 파일 시스템같은 것들이 그 예이다. 하지만 AccessibleObject.setAccessible 메소드의 도움을 받아 권한을 획득한 클라이언트는 리플렉션 기능을 통해 private 생성자를 다시 호출할 수 있다. 이러한 공격을 방어하려면 두 번째 객체를 생성하라는 요철을 받으면 예욀르 던지도록 생성자를 고쳐야 한다. 또 다른 방법은 public으로 선언된 정적 팩토리 메소드를 이용한다. 정적 팩토리 메소드를 이용해서 첫 번째 방법으로 공격하면 막지 못한다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Book</span> <span class="no">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Book</span><span class="o">();</span>

    <span class="kd">private</span> <span class="nf">Book</span><span class="o">()</span> <span class="o">{</span>
		<span class="o">...</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Book</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="no">INSTANCE</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>싱글턴 클래스를 직렬화 가능 클래스로 만들려면 클래스 선언에 implements Serializable을 추가하는 것으로는 부족하다. 모든 필드를 transient로 선언하고 readResolve 메소드를 추가해야한다. 그렇지 않으면 serialize된 객체가 역직화 될 때마다 새로운 객체가 생기게 된다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 싱글턴 상태를 유지하기 위한 readResolve 구현</span>
<span class="kd">private</span> <span class="nc">Object</span> <span class="nf">readResolve</span><span class="o">()</span> <span class="o">{</span>
	<span class="c1">// 동일한 Book 객체가 반환되도록 하는 동시에, 가짜 Book 객체는</span>
    <span class="c1">// 쓰레기 수집기가 처리하도록 만든다.</span>
	<span class="k">return</span> <span class="no">INSTANCE</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>jdk 1.5부터는 싱글턴을 구현할 때 새로운 방법을 사용할 수 있다. 원소가 하나뿐인 enum자료형을 정의하는 것이다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">Book</span> <span class="o">{</span>
	<span class="no">INSTANCE</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">readBook</span><span class="o">()</span> <span class="o">{...}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>이렇게 만들면 직렬화가 자동으로 처리된다는 것이다. 여러 객체가 생길일이 없고 리플렉션을 통한 공격에도 안전하다. 원소가 하나뿐인 enum 자료형이야말로 싱글턴을 구현하는 가장 좋은 방법이다. 클래스를 싱글턴으로 만들면 클라이언트를 테스트하기가 어려워질 수가 있다. 싱글턴이 어떤 인터페이스를 구현하는 것이 아니면 가짜 구현으로 대체할 수 없기 때문이다.</p>
]]></content>
      <categories>
        
          <category> Effective Java </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Android] Retrofit 사용법]]></title>
      <url>/android/2017/09/22/use-retrofit/</url>
      <content type="html"><![CDATA[<h1 id="android-retrofit-사용법">Android Retrofit 사용법</h1>
<p>Retrofit은 Square Open Source에서 만든 REST API 통신을 위한 안드로이드 라이브러리이다. 안드로이드 서비스를 개발하려면 서버와의 통신은 꼭 필요합니다. 다른 라이브러리를 사용하면 불필요하고 귀찮은 작업이 많습니다. Retrofit은 불필요한 작업을 최소화 하고 쓰기 쉽게 만들어진 라이브러리입니다.</p>

<p>먼저 gradle을 추가합니다.</p>
<div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">compile</span> <span class="s1">'io.reactivex.rxjava2:rxandroid:2.0.1'</span>
<span class="n">compile</span> <span class="s1">'io.reactivex.rxjava2:rxjava:2.1.3'</span>
<span class="n">compile</span> <span class="s1">'com.squareup.retrofit2:retrofit:2.3.0'</span>
<span class="n">compile</span> <span class="s1">'com.google.code.gson:gson:2.7'</span>
<span class="n">compile</span> <span class="s1">'com.android.support:recyclerview-v7:25.1.0'</span>
<span class="n">compile</span> <span class="s1">'com.squareup.retrofit2:converter-gson:2.1.0'</span>
<span class="n">compile</span> <span class="s1">'com.squareup.picasso:picasso:2.5.2'</span>
</code></pre></div></div>

<p>간단하게 파싱할 https://randomuser.me/api의 데이터입니다.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="err">results:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="err">gender:</span><span class="w"> </span><span class="s2">"male"</span><span class="p">,</span><span class="w">
            </span><span class="err">name:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="err">title:</span><span class="w"> </span><span class="s2">"mr"</span><span class="p">,</span><span class="w">
                </span><span class="err">first:</span><span class="w"> </span><span class="s2">"jimi"</span><span class="p">,</span><span class="w">
                </span><span class="err">last:</span><span class="w"> </span><span class="s2">"polon"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="err">location:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="err">street:</span><span class="w"> </span><span class="s2">"9350 itsenäisyydenkatu"</span><span class="p">,</span><span class="w">
                </span><span class="err">city:</span><span class="w"> </span><span class="s2">"kristinestad"</span><span class="p">,</span><span class="w">
                </span><span class="err">state:</span><span class="w"> </span><span class="s2">"south karelia"</span><span class="p">,</span><span class="w">
                </span><span class="err">postcode:</span><span class="w"> </span><span class="mi">14156</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="err">email:</span><span class="w"> </span><span class="s2">"jimi.polon@example.com"</span><span class="p">,</span><span class="w">
            </span><span class="err">login:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="err">username:</span><span class="w"> </span><span class="s2">"blackdog726"</span><span class="p">,</span><span class="w">
                </span><span class="err">password:</span><span class="w"> </span><span class="s2">"ranger"</span><span class="p">,</span><span class="w">
                </span><span class="err">salt:</span><span class="w"> </span><span class="s2">"cFE2HMuR"</span><span class="p">,</span><span class="w">
                </span><span class="err">md</span><span class="mi">5</span><span class="err">:</span><span class="w"> </span><span class="s2">"c7caf7af79bc56b4ddeee96bb9f90d85"</span><span class="p">,</span><span class="w">
                </span><span class="err">sha</span><span class="mi">1</span><span class="err">:</span><span class="w"> </span><span class="s2">"c2a0382305915dc106e2b75a48b2f454aef4f334"</span><span class="p">,</span><span class="w">
                </span><span class="err">sha</span><span class="mi">256</span><span class="err">:</span><span class="w"> </span><span class="s2">"ff6fbdd32246bd365b3a095c91408503a1f73620526e4f24da4759f439427096"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="err">dob:</span><span class="w"> </span><span class="s2">"1967-10-03 16:02:57"</span><span class="p">,</span><span class="w">
            </span><span class="err">registered:</span><span class="w"> </span><span class="s2">"2009-07-19 00:26:27"</span><span class="p">,</span><span class="w">
            </span><span class="err">phone:</span><span class="w"> </span><span class="s2">"02-657-116"</span><span class="p">,</span><span class="w">
            </span><span class="err">cell:</span><span class="w"> </span><span class="s2">"042-656-81-18"</span><span class="p">,</span><span class="w">
            </span><span class="err">id:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="err">name:</span><span class="w"> </span><span class="s2">"HETU"</span><span class="p">,</span><span class="w">
                </span><span class="err">value:</span><span class="w"> </span><span class="s2">"1167-163D"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="err">picture:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="err">large:</span><span class="w"> </span><span class="s2">"https://randomuser.me/api/portraits/men/76.jpg"</span><span class="p">,</span><span class="w">
                </span><span class="err">medium:</span><span class="w"> </span><span class="s2">"https://randomuser.me/api/portraits/med/men/76.jpg"</span><span class="p">,</span><span class="w">
                </span><span class="err">thumbnail:</span><span class="w"> </span><span class="s2">"https://randomuser.me/api/portraits/thumb/men/76.jpg"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="err">nat:</span><span class="w"> </span><span class="s2">"FI"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="err">...</span><span class="w">
    </span><span class="err">info:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="err">seed:</span><span class="w"> </span><span class="s2">"468e4162245cdf64"</span><span class="p">,</span><span class="w">
    </span><span class="err">results:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="err">page:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="err">version:</span><span class="w"> </span><span class="s2">"1.1"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>일단 데이터를 얻어오기 위해 interface를 정의합니다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">APIInterface</span> <span class="o">{</span>
    <span class="nd">@GET</span><span class="o">(</span><span class="s">"/api/"</span><span class="o">)</span>
    <span class="nc">Call</span><span class="o">&lt;</span><span class="nc">PersonModel</span><span class="o">&gt;</span> <span class="nf">getUsers</span><span class="o">(</span><span class="nd">@Query</span><span class="o">(</span><span class="s">"results"</span><span class="o">)</span> <span class="kt">int</span> <span class="n">results</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>
<p>실제로 요청하는 url은 https://randomuser.me/api/?results=1 입니다. 여기 result에 따라 몇 개의 데이터를 얻어올지 결정합니다.
그리고 인터페이스에 있는 메소드의 인자들은 url에 있는 ? 뒤에 query를 설명합니다.</p>

<p>model도 적절하게 생성합니다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Name</span> <span class="o">{</span>
    <span class="nd">@SerializedName</span><span class="o">(</span><span class="s">"title"</span><span class="o">)</span>
    <span class="nd">@Expose</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>
    <span class="nd">@SerializedName</span><span class="o">(</span><span class="s">"first"</span><span class="o">)</span>
    <span class="nd">@Expose</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">first</span><span class="o">;</span>
    <span class="nd">@SerializedName</span><span class="o">(</span><span class="s">"last"</span><span class="o">)</span>
    <span class="nd">@Expose</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">last</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">title</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTitle</span><span class="o">(</span><span class="nc">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getFirst</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">first</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFirst</span><span class="o">(</span><span class="nc">String</span> <span class="n">first</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">first</span> <span class="o">=</span> <span class="n">first</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getLast</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">last</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setLast</span><span class="o">(</span><span class="nc">String</span> <span class="n">last</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">last</span> <span class="o">=</span> <span class="n">last</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">UserProfileImage</span> <span class="o">{</span>
    <span class="nd">@SerializedName</span><span class="o">(</span><span class="s">"large"</span><span class="o">)</span>
    <span class="nd">@Expose</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">large</span><span class="o">;</span>
    <span class="nd">@SerializedName</span><span class="o">(</span><span class="s">"medium"</span><span class="o">)</span>
    <span class="nd">@Expose</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">medium</span><span class="o">;</span>
    <span class="nd">@SerializedName</span><span class="o">(</span><span class="s">"thumbnail"</span><span class="o">)</span>
    <span class="nd">@Expose</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">thumbnail</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getLarge</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">large</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setLarge</span><span class="o">(</span><span class="nc">String</span> <span class="n">large</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">large</span> <span class="o">=</span> <span class="n">large</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getMedium</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">medium</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMedium</span><span class="o">(</span><span class="nc">String</span> <span class="n">medium</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">medium</span> <span class="o">=</span> <span class="n">medium</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getThumbnail</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">thumbnail</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setThumbnail</span><span class="o">(</span><span class="nc">String</span> <span class="n">thumbnail</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">thumbnail</span> <span class="o">=</span> <span class="n">thumbnail</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Item</span> <span class="o">{</span>
    <span class="nd">@SerializedName</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span>
    <span class="nd">@Expose</span>
    <span class="kd">private</span> <span class="nc">Name</span> <span class="n">name</span><span class="o">;</span>
    <span class="nd">@SerializedName</span><span class="o">(</span><span class="s">"picture"</span><span class="o">)</span>
    <span class="nd">@Expose</span>
    <span class="kd">private</span> <span class="nc">UserProfileImage</span> <span class="n">userProfileImage</span><span class="o">;</span>
    <span class="nd">@SerializedName</span><span class="o">(</span><span class="s">"gender"</span><span class="o">)</span>
    <span class="nd">@Expose</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">gender</span><span class="o">;</span>
    <span class="nd">@SerializedName</span><span class="o">(</span><span class="s">"phone"</span><span class="o">)</span>
    <span class="nd">@Expose</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">phone</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getGender</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">gender</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setGender</span><span class="o">(</span><span class="nc">String</span> <span class="n">gender</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">gender</span> <span class="o">=</span> <span class="n">gender</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getPhone</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">phone</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPhone</span><span class="o">(</span><span class="nc">String</span> <span class="n">phone</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">phone</span> <span class="o">=</span> <span class="n">phone</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Name</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="nc">Name</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">UserProfileImage</span> <span class="nf">getUserProfileImage</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userProfileImage</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUserProfileImage</span><span class="o">(</span><span class="nc">UserProfileImage</span> <span class="n">userProfileImage</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">userProfileImage</span> <span class="o">=</span> <span class="n">userProfileImage</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PersonModel</span> <span class="o">{</span>
    <span class="nd">@SerializedName</span><span class="o">(</span><span class="s">"results"</span><span class="o">)</span>
    <span class="nd">@Expose</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Item</span><span class="o">&gt;</span> <span class="n">items</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="nd">@SerializedName</span><span class="o">(</span><span class="s">"page"</span><span class="o">)</span>
    <span class="nd">@Expose</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">page</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Item</span><span class="o">&gt;</span> <span class="nf">getItems</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">items</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setItems</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Item</span><span class="o">&gt;</span> <span class="n">items</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">items</span> <span class="o">=</span> <span class="n">items</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getPage</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">page</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPage</span><span class="o">(</span><span class="kt">int</span> <span class="n">page</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">page</span> <span class="o">=</span> <span class="n">page</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>또 결과를 보여줄 recyclerview도 만듭니다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">ItemClickListener</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">onItemClick</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RecyclerAdapter</span> <span class="kd">extends</span> <span class="nc">RecyclerView</span><span class="o">.</span><span class="na">Adapter</span><span class="o">&lt;</span><span class="nc">RecyclerView</span><span class="o">.</span><span class="na">ViewHolder</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="nc">ItemClickListener</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Item</span><span class="o">&gt;</span> <span class="n">items</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Context</span> <span class="n">context</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">RecyclerAdapter</span><span class="o">(</span><span class="nc">Context</span> <span class="n">context</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Item</span><span class="o">&gt;</span> <span class="n">items</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">context</span> <span class="o">=</span> <span class="n">context</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">items</span> <span class="o">=</span> <span class="n">items</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getItemTitle</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">items</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">position</span><span class="o">).</span><span class="na">getName</span><span class="o">().</span><span class="na">getFirst</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onItemClick</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">getItemTitle</span><span class="o">(</span><span class="n">position</span><span class="o">),</span> <span class="nc">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">RecyclerView</span><span class="o">.</span><span class="na">ViewHolder</span> <span class="nf">onCreateViewHolder</span><span class="o">(</span><span class="nc">ViewGroup</span> <span class="n">parent</span><span class="o">,</span> <span class="kt">int</span> <span class="n">viewType</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">RecyclerView</span><span class="o">.</span><span class="na">ViewHolder</span> <span class="n">holder</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

        <span class="nc">View</span> <span class="n">v</span> <span class="o">=</span> <span class="nc">LayoutInflater</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">parent</span><span class="o">.</span><span class="na">getContext</span><span class="o">()).</span><span class="na">inflate</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">list_item</span><span class="o">,</span> <span class="n">parent</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="n">holder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UsersViewHolder</span><span class="o">(</span><span class="n">v</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">holder</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onBindViewHolder</span><span class="o">(</span><span class="nc">RecyclerView</span><span class="o">.</span><span class="na">ViewHolder</span> <span class="n">holder</span><span class="o">,</span> <span class="kt">int</span> <span class="n">position</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">holder</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="o">((</span><span class="nc">UsersViewHolder</span><span class="o">)</span> <span class="n">holder</span><span class="o">).</span><span class="na">name</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">items</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">position</span><span class="o">).</span><span class="na">getName</span><span class="o">().</span><span class="na">getFirst</span><span class="o">());</span>
        <span class="nc">Picasso</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">context</span><span class="o">).</span><span class="na">load</span><span class="o">(</span><span class="n">items</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">position</span><span class="o">).</span><span class="na">getUserProfileImage</span><span class="o">().</span><span class="na">getThumbnail</span><span class="o">()).</span><span class="na">into</span><span class="o">(((</span><span class="nc">UsersViewHolder</span><span class="o">)</span> <span class="n">holder</span><span class="o">).</span><span class="na">profileImg</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getItemCount</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">items</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">UsersViewHolder</span> <span class="kd">extends</span> <span class="nc">RecyclerView</span><span class="o">.</span><span class="na">ViewHolder</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="nc">TextView</span> <span class="n">name</span><span class="o">;</span>
        <span class="kd">private</span> <span class="nc">ImageView</span> <span class="n">profileImg</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">UsersViewHolder</span><span class="o">(</span><span class="nc">View</span> <span class="n">itemView</span><span class="o">,</span> <span class="kd">final</span> <span class="nc">ItemClickListener</span> <span class="n">itemClickListener</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">(</span><span class="n">itemView</span><span class="o">);</span>
            <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="o">(</span><span class="nc">TextView</span><span class="o">)</span> <span class="n">itemView</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">text</span><span class="o">);</span>
            <span class="k">this</span><span class="o">.</span><span class="na">profileImg</span> <span class="o">=</span> <span class="o">(</span><span class="nc">ImageView</span><span class="o">)</span> <span class="n">itemView</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">userImg</span><span class="o">);</span>

            <span class="n">itemView</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="nc">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">itemClickListener</span><span class="o">.</span><span class="na">onItemClick</span><span class="o">(</span><span class="n">getAdapterPosition</span><span class="o">());</span>
                <span class="o">}</span>
            <span class="o">});</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>마지막으로 retrofit을 만듭니다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Retrofit</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Retrofit</span><span class="o">.</span><span class="na">Builder</span><span class="o">().</span><span class="na">baseUrl</span><span class="o">(</span><span class="s">"https://randomuser.me"</span><span class="o">).</span><span class="na">addConverterFactory</span><span class="o">(</span><span class="nc">GsonConverterFactory</span><span class="o">.</span><span class="na">create</span><span class="o">()).</span><span class="na">build</span><span class="o">();</span>
<span class="nc">APIInterface</span> <span class="n">service</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">APIInterface</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="nc">Call</span><span class="o">&lt;</span><span class="nc">PersonModel</span><span class="o">&gt;</span> <span class="n">call</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">getUsers</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>
<span class="n">call</span><span class="o">.</span><span class="na">enqueue</span><span class="o">(</span><span class="k">new</span> <span class="nc">Callback</span><span class="o">&lt;</span><span class="nc">PersonModel</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResponse</span><span class="o">(</span><span class="nc">Call</span><span class="o">&lt;</span><span class="nc">PersonModel</span><span class="o">&gt;</span> <span class="n">call</span><span class="o">,</span> <span class="nc">Response</span><span class="o">&lt;</span><span class="nc">PersonModel</span><span class="o">&gt;</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">isSuccessful</span><span class="o">())</span> <span class="o">{</span>
            <span class="nc">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="s">"Success"</span><span class="o">,</span> <span class="n">response</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
            <span class="nc">PersonModel</span> <span class="n">person</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">body</span><span class="o">();</span>
            <span class="n">recyclerView</span><span class="o">.</span><span class="na">setAdapter</span><span class="o">(</span><span class="k">new</span> <span class="nc">RecyclerAdapter</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="n">response</span><span class="o">.</span><span class="na">body</span><span class="o">().</span><span class="na">getItems</span><span class="o">()));</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFailure</span><span class="o">(</span><span class="nc">Call</span><span class="o">&lt;</span><span class="nc">PersonModel</span><span class="o">&gt;</span> <span class="n">call</span><span class="o">,</span> <span class="nc">Throwable</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="s">"Failed"</span><span class="o">,</span> <span class="s">"Failed Connection"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">});</span>
</code></pre></div></div>
]]></content>
      <categories>
        
          <category> Android </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Effective Java] Builder Pattern]]></title>
      <url>/effective%20java/2017/09/14/builder-pattern/</url>
      <content type="html"><![CDATA[<h1 id="builder-pattern">Builder Pattern</h1>
<p>정적 팩토리 메소드나 생성자는 같은 문제를 가지고 있다. 선택적 인자가 많은 상황에 잘 적응하지 못한다는 것이다. 이럴때에 점층적 생성자 패턴을 적용하기는 하지만 필요없는 인자를 넣어 줘야 할 때도 있고 클라이언트 코드를 작성하기도 어려워진다. 그리고 가독성도 많이 떨어진다. 다른 방법으로 자바빈 패턴이있다. 일단 객체를 생성한 뒤에 세터를 사용해 객체에 값을 넣어주는 방법이다. 하지만 객체를 만들면서 초기화 작업을 하지 못하므로 객체의 일관성이 일시적으로 깨질 수 있다는 것이다. 빌더 패턴을 사용하면 이 문제를 해결 할 수 있다.</p>

<h2 id="code">Code</h2>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">NutritionFacts</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">servingSize</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">servings</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">calories</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">fat</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">sodium</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">carbohydrate</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Builder</span> <span class="o">{</span>
        <span class="c1">// 필수인자</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">servingSize</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">servings</span><span class="o">;</span>
        <span class="c1">// 선택적 인자 - 기본값으로 초기화</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">calories</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">fat</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">sodium</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">carbohydrate</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">Builder</span><span class="o">(</span><span class="kt">int</span> <span class="n">servingSize</span><span class="o">,</span> <span class="kt">int</span> <span class="n">servings</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">servingSize</span> <span class="o">=</span> <span class="n">servingSize</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">servings</span> <span class="o">=</span> <span class="n">servings</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="nc">Builder</span> <span class="nf">calories</span><span class="o">(</span><span class="kt">int</span> <span class="n">val</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">calories</span> <span class="o">=</span> <span class="n">val</span><span class="o">;</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="nc">Builder</span> <span class="nf">fat</span><span class="o">(</span><span class="kt">int</span> <span class="n">val</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">fat</span> <span class="o">=</span> <span class="n">val</span><span class="o">;</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="nc">Builder</span> <span class="nf">sodium</span><span class="o">(</span><span class="kt">int</span> <span class="n">val</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">sodium</span> <span class="o">=</span> <span class="n">val</span><span class="o">;</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="nc">Builder</span> <span class="nf">carbohydrate</span><span class="o">(</span><span class="kt">int</span> <span class="n">val</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">carbohydrate</span> <span class="o">=</span> <span class="n">val</span><span class="o">;</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="nc">NutritionFacts</span> <span class="nf">build</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">NutritionFacts</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nf">NutritionFacts</span><span class="o">(</span><span class="nc">Builder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">servingSize</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">servingSize</span><span class="o">;</span>
        <span class="n">servings</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">servings</span><span class="o">;</span>
        <span class="n">calories</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">calories</span><span class="o">;</span>
        <span class="n">fat</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">fat</span><span class="o">;</span>
        <span class="n">sodium</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">sodium</span><span class="o">;</span>
        <span class="n">carbohydrate</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">carbohydrate</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BuilderPattern</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">NutritionFacts</span> <span class="n">n</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NutritionFacts</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">).</span><span class="na">calories</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>
<p>NutritionFacts 객체는 변경이 불가능하고 모든 인자의 기본값이 한곳에 모여 있다. 그리고 빌더에 정의된 설정 매소드는 빌더 객체 자신을 반환하므로, 설정 매소드를 호출하는 코드는 쭉 이어서 쓸 수 있다. 또 작성하기도 쉽고 가독성도 뛰어나다.</p>

<h2 id="빌더-패턴-단점">빌더 패턴 단점</h2>
<p>객체를 만들려면 빌더 객체를 생성해야 한다는 것이다.  빌더 객체를 만드는 오버헤드가 문제가 안될 수 도있지만 성능이 중요한 상황에서는 고려해야한다.</p>
]]></content>
      <categories>
        
          <category> Effective Java </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
    <entry>
      <title><![CDATA[[Effective Java] 정적 팩토리 메소드]]></title>
      <url>/effective%20java/2017/09/13/static-factory-method/</url>
      <content type="html"><![CDATA[<h1 id="정적-팩토리-메소드">정적 팩토리 메소드</h1>
<p>클래스를 통해 객체를 만드는 방법은 public으로 선언된 생성자를 사용하는 것이다. 또 다른 방법은 클래스의 public으로 선언된 정적 팩토리 메소드(Static Factory Method)를 사용하는 것이다. 이 메소드는 static로 선언되어 있어서 외부에서 바로 접근할 수 있다.</p>

<h2 id="정적-팩토리-메소드의-장점">정적 팩토리 메소드의 장점</h2>
<ol>
  <li>생성자와는 달리 이름이 있다.
생정자의 전달되는 인자들은 어떤 객체가 생성되는지를 설명하지 못하지만, 정적 팩토리 메소드는 이름만 잘 짓는다면 어떤 객체가 만들어 지는지 설명할 수 있다.</li>
  <li>생성자와는 달리 호출할 때마다 새로운 객체를 생성할 필요가 없다.
변경 불가능 클래스라면 이미 만들어둔 객체를 활용할 수도 있고, 만든 객체를 캐시 해놓고 재사용하여 같은 객체가 불필요하게 거듭 생성되는 일을 피할 수도 있다. 동일한 객체가 요청되는 일이 잦고, 특히 객체를 만드는 비용이 클 때 적용하면 성능을 크게 개선할 수 있다. 다음과 같은 코드가 정적 팩토리 메소드를 적용한 것이다.
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Boolean</span> <span class="nf">valueOf</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
         <span class="k">return</span> <span class="n">b</span> <span class="o">?</span> <span class="nc">Boolean</span><span class="o">.</span><span class="na">TRUE</span> <span class="o">:</span> <span class="nc">Boolean</span><span class="o">.</span><span class="na">FALSE</span><span class="o">;</span>
     <span class="o">}</span>
</code></pre></div>    </div>
    <p>정적 팩토리 메소드를 사용하면 같은 객체를 반복해서 반환할 수 있으므로 어떤 시점에 어떤 객체가 얼마나 존재할지를 정밀하게 제어할 수 있다. 이런 기능을 갖춘 클래스를 개체 통제 클래스(instance-controlled class)라고 부른다. 개체 수를 제어하면 싱글톤 패턴을 따를 수 있고, 객체 생성이 불가능한 클래스를 만들 수도 있다. 변경 불가능의 클래스의 경우 두 개의 같은 객체가 존재하지 못하도록 할 수도 있다.</p>
  </li>
  <li>생성자와는 달리 반환값 자료형의 하위 자료형 객체를 반환할 수 있다는 것이다.
public으로 선언되지 않은 클래스의 객체를 반환하는 API를 만들 수 있다. 그러면 구현 세부사항을 감출 수 있으므로 아주 간결한 API가 가능하다. 인터페이스 기반 프레인워크(interface-based framework)구현에 적합한데, 이 프레임워크에서는 정적 팩토리 메소드의 반환값 자료형으로 이용된다. 인터페이스는 정적 메소드를 가질 수 없으므로, 관습상 반환값 자료형이 Type이라는 이름의 인터페이스인 정적 팩토리 메소드는 Type라는 이름의 객체 생성 불가능 클래스안에 둔다.
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1">// 서비스 인터페이스</span>
 <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ServiceInterface</span> <span class="o">{</span>
     <span class="kt">int</span> <span class="nf">add</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">);</span>
     <span class="kt">int</span> <span class="nf">mul</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">);</span>
     <span class="o">...</span> <span class="c1">// 서비스에 고유한 메소드들이 이 자리에 온다</span>
 <span class="o">}</span>
</code></pre></div>    </div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServiceImplement</span> <span class="kd">implements</span> <span class="nc">ServiceInterface</span> <span class="o">{</span>
     <span class="nd">@Override</span>
     <span class="kd">public</span> <span class="kt">int</span> <span class="nf">add</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
         <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">;</span>
     <span class="o">}</span>

     <span class="nd">@Override</span>
     <span class="kd">public</span> <span class="kt">int</span> <span class="nf">mul</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
         <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="o">;</span>
     <span class="o">}</span>
 <span class="o">}</span>
</code></pre></div>    </div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1">//서비스 제공자 인터페이스</span>
 <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProviderInterface</span> <span class="o">{</span>
     <span class="nc">ServiceInterface</span> <span class="nf">newService</span><span class="o">();</span>
 <span class="o">}</span>
</code></pre></div>    </div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProviderImplement</span> <span class="kd">implements</span> <span class="nc">ProviderInterface</span> <span class="o">{</span>
     <span class="nd">@Override</span>
     <span class="kd">public</span> <span class="nc">ServiceInterface</span> <span class="nf">newService</span><span class="o">()</span> <span class="o">{</span>
         <span class="k">return</span> <span class="k">new</span> <span class="nf">ServiceImplement</span><span class="o">();</span>
     <span class="o">}</span>
 <span class="o">}</span>
</code></pre></div>    </div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1">// 서비스 등록과 접근에 사용되는 객체 생성 불가능 클래스</span>
 <span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServiceProvider</span> <span class="o">{</span>
     <span class="kd">private</span> <span class="nf">ServiceProvider</span><span class="o">()</span> <span class="o">{}</span> <span class="c1">// 인스턴스 생성 X</span>
	
     <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">ProviderInterface</span><span class="o">&gt;</span> <span class="n">providers</span> <span class="o">=</span>
         <span class="k">new</span> <span class="nc">ConcurrentHashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">ProviderInterface</span><span class="o">&gt;();</span>
     <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">DEFAULT_PROVIDER_NAME</span> <span class="o">=</span> <span class="s">"&lt;def&gt;"</span><span class="o">;</span>
	
     <span class="c1">// 제공자 등록 API</span>
     <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">registerDefaultProvider</span><span class="o">(</span><span class="nc">ProviderInterface</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
         <span class="n">registerProvider</span><span class="o">(</span><span class="no">DEFAULT_PROVIDER_NAME</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
     <span class="o">}</span>
	
     <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">registerProvider</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">ProviderInterface</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
         <span class="n">providers</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
     <span class="o">}</span>
	
     <span class="c1">// 서비스 접근 API</span>
     <span class="kd">public</span> <span class="kd">static</span> <span class="nc">ServiceInterface</span> <span class="nf">newInstance</span><span class="o">()</span> <span class="o">{</span>
         <span class="k">return</span> <span class="nf">newInstance</span><span class="o">(</span><span class="no">DEFAULT_PROVIDER_NAME</span><span class="o">);</span>
     <span class="o">}</span>
	
     <span class="kd">public</span> <span class="kd">static</span> <span class="nc">ServiceInterface</span> <span class="nf">newInstance</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
         <span class="nc">ProviderInterface</span> <span class="n">p</span> <span class="o">=</span> <span class="n">providers</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
         <span class="k">if</span> <span class="o">(</span><span class="n">p</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
             <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span>
                 <span class="s">"No provider registered with name: "</span> <span class="o">+</span> <span class="n">name</span><span class="o">);</span>
         <span class="o">}</span>
         <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="na">newService</span><span class="o">();</span>
     <span class="o">}</span>
 <span class="o">}</span>
</code></pre></div>    </div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServiceMain</span> <span class="o">{</span>
     <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
         <span class="nc">ServiceProvider</span><span class="o">.</span><span class="na">registerDefaultProvider</span><span class="o">(</span><span class="k">new</span> <span class="nc">ProviderImplement</span><span class="o">());</span>
         <span class="nc">ServiceProvider</span><span class="o">.</span><span class="na">registerProvider</span><span class="o">(</span><span class="s">"BoWoon"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ProviderImplement</span><span class="o">());</span>
	
         <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">ServiceProvider</span><span class="o">.</span><span class="na">newInstance</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">4</span><span class="o">));</span>
         <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">ServiceProvider</span><span class="o">.</span><span class="na">newInstance</span><span class="o">().</span><span class="na">mul</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">));</span>
         <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">ServiceProvider</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="s">"BoWoon"</span><span class="o">).</span><span class="na">add</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">5</span><span class="o">));</span>
     <span class="o">}</span>
 <span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>형인자 자료형(parameterized type) 객체를 만들 때 편하다
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;&gt;();</span>
</code></pre></div>    </div>
    <p>자료형 명세를 중복하면 형인자가 늘어남에 따라 길고 복잡한 코드가 만들어진다. 하지만 정적 팩토리 메소드를 사용하면 컴파일러가 형인자를 스스로 알아내도록 할 수 있다. 이런 기법을 자료형 유추(type inference)라고 부른다.</p>
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">K</span><span class="o">,</span> <span class="no">V</span><span class="o">&gt;</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span> <span class="no">V</span><span class="o">&gt;</span> <span class="nf">newInstance</span><span class="o">()</span> <span class="o">{</span>
     <span class="k">return</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span> <span class="no">V</span><span class="o">&gt;();</span>
 <span class="o">}</span>
</code></pre></div>    </div>
    <p>이런 메소드가 있으면 아까와 같은 코드를 간결하게 작성할 수 있다.</p>
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nc">Map</span> <span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="nc">HashMap</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="정적-팩토리-메소드의-단점">정적 팩토리 메소드의 단점</h2>
<ol>
  <li>public이나 protected로 선언된 생성자가 없으므로 하위 클래스를 만들 수 없다</li>
  <li>정적 팩토리 메소드가 다른 정적 메소드와 확연히 구분되지 않는다는 것</li>
</ol>
]]></content>
      <categories>
        
          <category> Effective Java </category>
        
      </categories>
      <tags>
        
      </tags>
      <tags></tags>
    </entry>
  
</search>
